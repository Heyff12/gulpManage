{"version":3,"sources":["b/member_detail.js"],"names":["require","$","yanzheng","close_tip","scroll_more","append_ul","list","con_list","con_list1","b","times_add","hide","last_len","i","append","scroll_data","body_height","Math","floor","height","toFixed","nomoredata_show","window","setTimeout","nomoredata_hide","nomor_show","scroll_if","console","log","Array","add_load_img","get","document","ready"],"mappings":"AAAA,YAEAA,UAAA,sBAAA,WACAA,SAAA,QAAA,WAAA,YAAA,eAAA,SAAAC,EAAAC,EAAAC,EAAAC,GACAH,EAAA,WAuBA,QAAAI,KACA,GAGAC,GAHAC,EAAA,wbACAC,EAAA,iMAYA,IATA,KAAAC,GACAH,EAAAE,EACAC,EAAA,IAEAH,EAAAC,EACAE,EAAA,GAGAC,IACAA,EAAA,EAAA,CACAT,EAAA,SAAAU,MAGA,KAAA,GADAC,GAAA,EACAC,EAAA,EAAAA,EAAAD,EAAAC,IACAZ,EAAA,kBAAAa,OAAAR,EAaA,OAXAF,GAAAW,YAAAC,YAAAC,KAAAC,MAAAjB,EAAA,QAAAkB,UAAAC,QAAA,GACAR,GAAA,GACAR,EAAAiB,kBACAC,OAAAC,WAAAnB,EAAAoB,gBAAA,KACApB,EAAAW,YAAAU,YAAA,GAEArB,EAAAW,YAAAU,YAAA,EAEArB,EAAAW,YAAAW,WAAA,EACAC,QAAAC,IAAA,mBAAAxB,EAAAW,YAAAW,WACAC,QAAAC,IAAA,oBAAAxB,EAAAW,YAAAU,aACA,EAGA,IAAA,GAAAZ,GAAA,EAAAA,EAAA,GAAAA,IACAZ,EAAA,kBAAAa,OAAAR,EAEAL,GAAA,SAAAU,OACAP,EAAAW,YAAAW,WAAA,EACAtB,EAAAW,YAAAC,YAAAC,KAAAC,MAAAjB,EAAA,QAAAkB,UAAAC,QAAA,GACAO,QAAAC,IAAA,mBAAAxB,EAAAW,YAAAW,WACAC,QAAAC,IAAA,oBAAAxB,EAAAW,YAAAU,YA/DA,GAEAhB,IAFA,GAAAoB,OAEA,GAEAnB,EAAA,CAEAN,GAAA0B,aAAA,qBAEA1B,EAAAA,YAAAC,GAEAJ,EAAA,qBAAA8B,IAAA,KAAA,WACA9B,EAAA+B,UAAAC,MAAA,WAMA5B,SAoMAF,EAAAA","file":"../../../js/b/member_detail.js","sourcesContent":["require(['../require-config2'], function() {\n    require([\"zepto\", \"yanzheng\", \"close_tip\", \"scroll_more\"], function($, yanzheng, close_tip, scroll_more) {\n        $(function() {\n            //流水号\n            var trade_listnum = new Array();\n            //滚动加载---------------------------------------------------------------   \n            var b = 1, //测试专用--变更加载数据\n                times_add = 0; //测试专用--控制停止加载数据判断依据 \n            //添加图标和没有更多文字提示\n            scroll_more.add_load_img('.js_member_detail');\n            //默认执行--测试专用   \n            scroll_more.scroll_more(append_ul);\n            //活动储值详情----------------------------------------------------------------------------------------------------------------------------------------------------\n            $('.js_member_detail').get(0) && (~ function() {\n                $(document).ready(function() {\n                    //获取会员信息todo-show\n                    //get_member();\n                    //获取会员消费储值列表todo-show\n                    //get_rechargeli();\n                    //测试\n                    append_ul();\n                });\n            }());\n            //测试\n            function append_ul() {\n                var con_list = '<li><dl><dd>储值赠送<span class=\"buy_back orange\">储值50送5</span></dd><dd class=\"grey\">2016-08-10 15:06:55</dd><div class=\"clearfix\"></div></dl><span class=\"history_num orange\">+<i class=\"i_normal\">5.00</i></span><div class=\"clearfix\"></div></li> <li><dl><dd>储值</dd><dd class=\"grey\">2016-08-10 15:06:55</dd><div class=\"clearfix\"></div></dl><span class=\"history_num orange\">+<i class=\"i_normal\">50.00</i></span><div class=\"clearfix\"></div></li>';\n                var con_list1 = '<li><dl><dd>储值消费</dd><dd class=\"grey\">2016-08-10 15:06:55</dd><div class=\"clearfix\"></div></dl><span class=\"history_num\">-<i class=\"i_normal\">25.00</i></span><div class=\"clearfix\"></div></li>';\n\n                var list;\n                if (b == '1') {\n                    list = con_list1;\n                    b = 0;\n                } else {\n                    list = con_list;\n                    b = 1;\n                }\n                //判断终止添加数据\n                times_add++;\n                if (times_add > 3) {\n                    $('.load').hide();\n                    //最后添加的数据\n                    var last_len = 5;\n                    for (var i = 0; i < last_len; i++) {\n                        $('.js_ul_history').append(list);\n                    }\n                    scroll_more.scroll_data.body_height = Math.floor($('body').height()).toFixed(0);\n                    if (last_len <= 0) {\n                        scroll_more.nomoredata_show();\n                        window.setTimeout(scroll_more.nomoredata_hide, 2000);\n                        scroll_more.scroll_data.nomor_show = false;\n                    } else {\n                        scroll_more.scroll_data.nomor_show = true;\n                    }\n                    scroll_more.scroll_data.scroll_if = false;\n                    console.log('AJAX:scroll_if==' + scroll_more.scroll_data.scroll_if);\n                    console.log('AJAX:nomor_show==' + scroll_more.scroll_data.nomor_show);\n                    return false;\n                }\n                //正常添加数据\n                for (var i = 0; i < 20; i++) {\n                    $('.js_ul_history').append(list);\n                }\n                $('.load').hide();\n                scroll_more.scroll_data.scroll_if = true;\n                scroll_more.scroll_data.body_height = Math.floor($('body').height()).toFixed(0);\n                console.log('AJAX:scroll_if==' + scroll_more.scroll_data.scroll_if);\n                console.log('AJAX:nomor_show==' + scroll_more.scroll_data.nomor_show);\n            }\n            //获取会员信息\n            function get_member() {\n                var id = yanzheng.get_hash(c);\n                $.ajax({\n                    url: '/prepaid/v1/api/b/member/' + id,\n                    type: 'GET',\n                    dataType: 'json',\n                    data: {},\n                    beforeSend: function() {\n                        $('#loading').show();\n                        $('.zheceng').show();\n                    },\n                    success: function(data) {\n                        if (data.respcd != '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng').show();\n                            if (!data['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(data['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(data['respmsg']);\n                            }\n                        } else {\n                            var return_data = data.data;\n                            var m_img = return_data.avatar;\n                            var m_mobile = return_data.mobile;\n                            var m_name = return_data.name;\n                            var m_times = return_data.recharge_times;\n                            var m_amt = (return_data.recharge_amt / 100).toFixed(0);\n                            var m_balance = (return_data.balance / 100).toFixed(2);\n                            $('.js_m_img').attr('src', m_img);\n                            $('.js_m_tel').text(m_mobile);\n                            $('.js_m_name').text(m_name);\n                            $('.js_m_times').text(m_times);\n                            $('.js_m_all').text(m_amt);\n                            $('.js_m_loft').text(m_balance);\n                            $('.zheceng').hide();\n                        }\n                    },\n                    error: function(data) {\n                        $('#alert_alert').show();\n                        $('.zheceng').show();\n                        //$('.alert_con .alert_con_br').html('XMLHttpRequest.readyState:'+XMLHttpRequest.readyState+',XMLHttpRequest.status:'+XMLHttpRequest.status+',textStatus:'+textStatus+'!');\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function() {\n                        $('#loading').hide();\n                    }\n                });\n            }\n            //获取会员消费储值列表\n            function get_rechargeli() {\n                $.ajax({\n                    url: '/prepaid/v1/api/transactions',\n                    type: 'GET',\n                    dataType: 'json',\n                    data: {\n                        'c': yanzheng.get_hash(c),\n                        'biz_type': '1,2',\n                        'pos': $('#js_pos').val(),\n                        'count': 20,\n                    },\n                    beforeSend: function() {\n                        $('#loading').show();\n                        $('.zheceng').show();\n                    },\n                    success: function(data) {\n                        if (data.respcd != '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng').show();\n                            if (!data['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(data['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(data['respmsg']);\n                            }\n                        } else {\n                            var return_data = data.data;\n                            var last_len = 0;\n                            $(return_data).each(function(i, item) {\n                                var dl_data_set_l = trade_listnum.length;\n\n                                var tx_txamt = (return_data[i].txamt / 100).toFixed(2);\n                                var tx_pay_amt = (return_data[i].pay_amt / 100).toFixed(2);\n                                var tx_present_amt = (return_data[i].present_amt / 100).toFixed(2);\n                                var tx_pay_amt0 = (return_data[i].pay_amt / 100).toFixed(0);\n                                var tx_present_amt0 = (return_data[i].present_amt / 100).toFixed(0);\n                                var tx_time = return_data[i].sysdtm;\n                                var tx_status = return_data[i].biz_type;\n                                var biz_sn = return_data[i].biz_sn;\n                                var li_detail;\n                                //判断流水号是否重复\n                                var bizn_has = '0';\n                                for (var i = dl_data_set_l - 1; i > 0; i--) {\n                                    if (trade_listnum[i] == biz_sn) {\n                                        bizn_has = '1';\n                                        break;\n                                    }\n                                }\n                                if (bizn_has == '1') {\n                                    //流水号存在则退出\n                                    return true;\n                                } else {\n                                    trade_listnum.push(biz_sn);\n                                    last_len++;\n                                }\n                                if (tx_status == '1') {\n                                    //储值\n                                    li_detail = '<li><dl><dd>储值赠送<span class=\"buy_back orange\">储值' + tx_pay_amt0 + '送' + tx_present_amt0 + '</span></dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num orange\">+<i class=\"i_normal\">' + tx_present_amt + '</i></span><div class=\"clearfix\"></div></li> <li><dl><dd>储值</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num orange\">+<i class=\"i_normal\">' + tx_pay_amt + '</i></span><div class=\"clearfix\"></div></li>';\n                                } else if (tx_status == '2') {\n                                    //消费\n                                    li_detail = '<li><dl><dd>储值消费</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num orange\">-<i class=\"i_normal\">' + tx_txamt + '</i></span><div class=\"clearfix\"></div></li>';\n                                } else {\n                                    //退款\n                                    return true;\n                                }\n                                $(\".js_ul_history\").append(li_detail);\n                            });\n                            var pos_val = $('#js_pos').val() - 0;\n                            if (return_data.length < 20) {\n                                if (last_len > 0) {\n                                    scroll_more.scroll_data.nomor_show = true;\n                                } else {\n                                    scroll_more.nomoredata_show();\n                                    window.setTimeout(scroll_more.nomoredata_hide, 2000);\n                                    scroll_more.scroll_data.nomor_show = false;\n                                }\n                                scroll_more.scroll_data.scroll_if = false;\n                            } else {\n                                pos_val += 20;\n                                $('#js_pos').val(pos_val);\n                                scroll_more.scroll_data.scroll_if = true;\n                            }\n                            $('.zheceng').hide();\n                            $('.load').hide();\n                            scroll_more.scroll_data.body_height = Math.floor($('body').height()).toFixed(0);\n                        }\n                    },\n                    error: function(data) {\n                        $('#alert_alert').show();\n                        $('.zheceng').show();\n                        //$('.alert_con .alert_con_br').html('XMLHttpRequest.readyState:'+XMLHttpRequest.readyState+',XMLHttpRequest.status:'+XMLHttpRequest.status+',textStatus:'+textStatus+'!');\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function() {\n                        $('#loading').hide();\n                    }\n                });\n            }\n            //关闭弹框\n            close_tip.close_tip();\n\n            function nomoredata_hide() {\n                //$('#nomoredata').hide();\n                $(\"#nomoredata\").animate({ opacity: 0, }, 500, 'ease-out');\n            }\n\n        })\n    })\n})\n"]}
{"version":3,"sources":["b/activity_detail_change.js"],"names":["require","$","requestCumulate","url","page","data","pos","count","refreshManager","activity_id","biz_type_l","ajax","type","dataType","beforeSend","show","context","success","respond","respcd","html","parserRequestSuccessData","error","xhr","complete","storpLoadMoerAnimation","loading","hide","requestStatistics","document","getElementsByClassName","innerText","parseInt","pay_amt","present_amt","datas","i","length","itemSource","currentSNs","indexOf","biz_sn","push","htmlItem","imgUrl","sysd","payAmt","presentAmt","createHTMLItem","htmlPresentItem","getElementById","appendChild","canLoadMoer","isActive","nickName","createElement","className","htmlContent","htmlImg","src","htmlName","htmlAmt2","temp","htmlTime","htmlAmt","htmlLine","getQueryString","name","reg","RegExp","r","window","location","search","substr","match","unescape","getBizType","tempArray","href","split","loadMoerAnimation","refreshElement","style","display","obj","getAllItems","getElementMaxY","allItems","offsetTop","nomoredata_hide","animate","opacity","RefreshManager","lastScrollY","loadMoer","this","canScroll","onscroll","e","scrollScrrlY","documentElement","scrollTop","body","elementMaxY","scrrenH","innerHeight","clientHeight","screenScrollMaxY","setTimeout","on"],"mappings":"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","file":"../../../js/b/activity_detail_change.js","sourcesContent":["'use strict';\n\n// require(['../require-config'], function() {\n//         require([\"native\"], function(native) {\n//             $(function() {\n//                 //设置菜单空\n//                 var menu_data = { menus: [] };\n//                 native.setNavMenu(menu_data, function(cb) {\n//                     console.log(cb.ret);\n//                 });\n//             })\n//         })\n//     })\n/**\n * Created by liteng on 2016/11/14.\n */\nrequire(['../require-config2'], function () {\n    require([\"zepto\"], function ($) {\n        $(function () {\n            //model\n            var itemController = function itemController(type) {\n                this.type = type;\n            };\n\n            var RefreshManager = function RefreshManager(lastScrollY, loadMoer) {\n                this.lastScrollY = lastScrollY;\n                this.canLoadMoer = loadMoer;\n                this.currentSNs = [];\n                this.activity_id = getQueryString('activity_id');\n                this.biz_type_l = getBizType();\n                this.loading = false;\n                this.canScroll = true;\n                // this.loadDomain = 'http://192.168.0.7:7013';\n            };\n\n            var refreshManager = new RefreshManager(0, false);\n\n            //event\n\n            window.onscroll = function (e) {\n                // var e =e || window.event;\n                if (refreshManager.canScroll) {\n                    var scrollScrrlY = document.documentElement.scrollTop || document.body.scrollTop;\n                    var elementMaxY = getElementMaxY();\n                    var scrrenH = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n                    var screenScrollMaxY = scrollScrrlY + scrrenH;\n                    if (screenScrollMaxY > elementMaxY && scrollScrrlY > refreshManager.lastScrollY && refreshManager.canLoadMoer && !refreshManager.loading) {\n                        refreshManager.canLoadMoer = false;\n                        refreshManager.loading = true;\n                        loadMoerAnimation();\n                        window.setTimeout(function () {\n                            requestCumulate('/prepaid/v1/api/transactions', refreshManager.currentSNs.length);\n                        }, 3000);\n                    } else if (screenScrollMaxY > elementMaxY && scrollScrrlY > refreshManager.lastScrollY && !refreshManager.canLoadMoer && !refreshManager.loading) {\n                        $('.load').hide();\n                        $(\"#nomoredata\").animate({ opacity: 0.7 }, 500, 'ease-out');\n                        window.setTimeout(nomoredata_hide, 2000);\n                        refreshManager.canScroll = false;\n                    }\n                    refreshManager.lastScrollY = scrollScrrlY;\n                }\n            };\n\n            if (refreshManager.biz_type_l === 1) {\n                requestStatistics();\n            }\n            requestCumulate('/prepaid/v1/api/transactions', refreshManager.currentSNs.length);\n            //private func\n\n            //请求累计储值函数\n            function requestCumulate(url, page) {\n                var data = {\n                    pos: page,\n                    count: 20\n                };\n                if (refreshManager.activity_id != 0) {\n                    data['activity_id'] = refreshManager.activity_id;\n                }\n                data['biz_type_l'] = refreshManager.biz_type_l;\n\n                $.ajax({\n                    type: 'GET',\n                    url: url,\n                    // data to be added to query string:\n                    data: data,\n                    // type of data we are expecting in return:\n                    dataType: 'json',\n                    beforeSend: function beforeSend() {\n                        $('#load_small_bg').show();\n                        //$('.zheceng1').show();\n                    },\n                    context: $('body'),\n                    success: function success(respond) {\n                        if (respond.respcd !== '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng1').show();\n                            if (!respond['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(respond['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(respond['respmsg']);\n                            }\n                        } else {\n                            parserRequestSuccessData(respond['data']);\n                            //$('.zheceng1').hide();\n                        }\n                    },\n                    error: function error(xhr, type) {\n                        $('#alert_alert').show();\n                        $('.zheceng1').show();\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function complete() {\n                        storpLoadMoerAnimation();\n                        refreshManager.loading = false;\n                        $('#load_small_bg').hide();\n                    }\n                });\n            }\n\n            function requestStatistics() {\n                var data = {};\n                if (refreshManager.activity_id != 0) {\n                    data['activity_id'] = refreshManager.activity_id;\n                }\n                $.ajax({\n                    type: 'GET',\n                    url: '/prepaid/v1/api/stat/recharge',\n                    // data to be added to query string:\n                    data: data,\n                    dataType: 'json',\n                    context: $('body'),\n                    beforeSend: function beforeSend() {\n                        $('#load_small_bg').show();\n                        //$('.zheceng').show();\n                    },\n                    success: function success(respond) {\n                        if (respond.respcd !== '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng').show();\n                            if (!respond['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(respond['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(respond['respmsg']);\n                            }\n                        } else {\n                            document.getElementsByClassName('js-storedValue')[0].innerText = parseInt(respond.data.pay_amt / 100) + '';\n                            document.getElementsByClassName('js-presentValue')[0].innerText = '￥' + parseInt(respond.data.present_amt / 100);\n                            //$('.zheceng').hide();\n                        }\n                    },\n                    error: function error(xhr, type) {\n                        $('#alert_alert').show();\n                        $('.zheceng').show();\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function complete() {\n                        $('#load_small_bg').hide();\n                    }\n                });\n            }\n\n            //parser成功\n            function parserRequestSuccessData(datas) {\n                storpLoadMoerAnimation();\n                for (var i = 0; i < datas.length; i++) {\n                    var itemSource = datas[i];\n                    if (refreshManager.currentSNs.indexOf(itemSource.biz_sn) === -1) {\n                        refreshManager.currentSNs.push(itemSource.biz_sn);\n                        var imgUrl = itemSource['c_avatar'];\n                        var sysd = itemSource['sysdtm'];\n                        var htmlItem;\n                        if (refreshManager.biz_type_l === 1) {\n                            var payAmt = parseInt(itemSource['pay_amt'] / 100);\n                            var presentAmt = parseInt(itemSource['present_amt'] / 100);\n                            htmlItem = createHTMLItem(false, imgUrl, '储值', payAmt, presentAmt, sysd);\n                            var htmlPresentItem = createHTMLItem(true, imgUrl, '储值赠送', payAmt, presentAmt, sysd);\n                            document.getElementById('content').appendChild(htmlPresentItem);\n                        } else {\n                            htmlItem = createHTMLItem(false, imgUrl, '储值消费', itemSource['txamt'] / 100, 0, sysd);\n                        }\n                        document.getElementById('content').appendChild(htmlItem);\n                    }\n                }\n                refreshManager.canLoadMoer = datas.length >= 20;\n            }\n\n            function createHTMLItem(isActive, imgUrl, nickName, payAmt, presentAmt, sysd) {\n                var htmlItem = document.createElement('div');\n                htmlItem.className = 'detail-list';\n                var htmlContent = document.createElement('div');\n                htmlContent.className = 'list-content';\n                htmlItem.appendChild(htmlContent);\n                //头像\n                var htmlImg = document.createElement('img');\n                htmlImg.src = imgUrl;\n                //名字和活动类型\n                var htmlName = document.createElement('span');\n                htmlName.className = 'js-name';\n                htmlName.innerText = nickName;\n                var htmlAmt2 = document.createElement('span');\n                if (isActive) {\n                    var temp = document.createElement('span');\n                    temp.className = 'js-storedTag box-orange';\n                    temp.innerText = '储值' + payAmt + '送' + presentAmt;\n                    htmlName.appendChild(temp);\n                    htmlAmt2.innerText = presentAmt;\n                } else {\n                    htmlAmt2.innerText = payAmt;\n                }\n                var htmlTime = document.createElement('span');\n                htmlTime.className = 'js-date';\n                htmlTime.innerText = sysd;\n                var htmlAmt = document.createElement('span');\n                htmlAmt.className = 'amount';\n                htmlAmt.innerText = '￥';\n                htmlAmt.appendChild(htmlAmt2);\n\n                htmlContent.appendChild(htmlImg);\n                htmlContent.appendChild(htmlName);\n                htmlContent.appendChild(htmlTime);\n                htmlContent.appendChild(htmlAmt);\n                var htmlLine = document.createElement('div');\n                htmlLine.className = 'footer-line';\n                htmlItem.appendChild(htmlLine);\n                return htmlItem;\n            }\n\n            function getQueryString(name) {\n                var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n                var r = window.location.search.substr(1).match(reg);\n                if (r != null) return unescape(r[2]);\n                return 0;\n            }\n\n            function getBizType() {\n                var tempArray = window.location.href.split('/');\n                if (tempArray[tempArray.length - 1] === 'consume.html') {\n                    return 2;\n                }\n                return 1;\n            }\n\n            function loadMoerAnimation() {\n                var refreshElement = document.getElementsByClassName('load')[0];\n                refreshElement.style.display = 'block';\n            }\n\n            function storpLoadMoerAnimation() {\n                var obj = document.getElementsByClassName('load')[0];\n                obj.style.display = 'none';\n            }\n\n            function getAllItems() {\n                return document.getElementsByClassName('footer-line');\n            }\n\n            //界面加载完成后删除最后一个item的分割线\n            function removeLastItemLine(itemCont) {\n                var allItems = getAllItems();\n                for (var i = 0; i < allItems.length; i++) {\n                    if (i == allItems.length - 1) {\n                        allItems[i].style.display = 'none';\n                    }\n                }\n            }\n\n            function getElementMaxY() {\n                var allItems = getAllItems();\n                for (var i = 0; i < allItems.length; i++) {\n                    if (i == allItems.length - 1) {\n                        return allItems[i].offsetTop;\n                    }\n                }\n            }\n\n            //关闭弹框\n            $('.js_alert_con_close').on('click', function () {\n                $('.alert_con').hide();\n                // $('.alert_con .alert_con_br').html();\n                $('.zheceng').hide();\n                $('.zheceng1').hide();\n                $('.zheceng2').hide();\n            });\n\n            //隐藏没有更多信息了\n            function nomoredata_hide() {\n                $(\"#nomoredata\").animate({ opacity: 0 }, 500, 'ease-out');\n            }\n        });\n    });\n});"]}
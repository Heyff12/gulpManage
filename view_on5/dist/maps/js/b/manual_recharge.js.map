{"version":3,"sources":["b/manual_recharge.js"],"names":["require","$","ajax_rule","if_menu","native","date_day","iosselect","get_baseinfo","merchantinfo_request","balance_request","userInfo_request","recharge_request","recharge_model","c","getQueryParamString","rule_index","pay_amt","val","toast","msg","parseFloat","toFixed","grid_index","password","length","passwd","attr","ajax","url","type","dataType","contentType","data","JSON","stringify","beforeSend","XMLHttpRequest","show","success","respcd","html","url_val","location","protocol","host","goto_url","error","complete","hide","respond","merchant_name","balance","mobile","recharge_rules_request","noact_noerr","status","rules","addClass","rules_dom","each","idx","rule","li_dom","parseInt","present_amt","ruleindex","append","removeAttr","name","reg","RegExp","r","window","search","substr","match","unescape","document","ready","on","removeClass","hasClass","this","value","substring"],"mappings":"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","file":"../../../js/b/manual_recharge.js","sourcesContent":["\"use strict\";\n\n/**\n * Created by liteng on 2017/5/18.\n */\nrequire(['../require-config2'], function () {\n    require([\"zepto\", \"ajax_rule\", \"if_menu\", \"native\", \"date_day\", \"iosselect\"], function ($, ajax_rule, if_menu, native, date_day, iosselect) {\n        $(function () {\n            var rule_index = 0;\n\n            $(document).ready(function () {\n                //获取信息--todo\n                // $('.js_recharge_rulediv').hide();\n                get_baseinfo();\n                recharge_rules_request();\n                //点击活动储值\n                $(document).on('touchstart', '.js_rules_title', function () {\n                    //取消自定义金额选中状态\n                    $('.s_custom_amount').removeClass('selected');\n                    $('.js_custom_amount').attr('readOnly', 'readOnly');\n                    //清除自定义金额输入框\n                    $('.js_custom_amount').val('');\n                    //选中活动储值\n                    $('.s_rules_amount').addClass('selected');\n                });\n                // $('.js_rules_title').live('click',function () {\n                //\n                // });\n                //点击自定义储值金额\n                $('.js_custom_title').on('click', function () {\n                    rule_index = 0;\n                    //取消活动金额选中状态\n                    $('.s_rules_amount').removeClass('selected');\n                    //清除活动金额子选项\n                    $('li').removeClass('li_choose');\n                    //选中活动储值\n                    $('.s_custom_amount').addClass('selected');\n                    $('.js_custom_amount').removeAttr('readOnly');\n                });\n                //活动储值子选项点击事件\n                $(document).on('touchstart', 'li', function () {\n                    if (!$('.s_rules_amount').hasClass('selected')) {\n                        return false;\n                    }\n                    $('li').removeClass('li_choose');\n                    $(this).addClass('li_choose');\n                    rule_index = $(this).attr('data-index');\n                });\n                // $('li').live('click',function () {\n                //\n                // });\n            });\n\n            $('.js_custom_amount').on('input', function () {\n                var val = $(this).val();\n                if (val.length > 0) {\n                    //不是正整数\n                    val = val.match(/\\d+(\\.\\d{0,2})?/) ? this.value.match(/\\d+(\\.\\d{0,2})?/)[0] : '';\n                    $(this).val(val);\n                }\n                if (val.length > 1 && val.substring(0, 1) == '0' && val.substring(0, 2) != '0.') {\n                    //错误格式  比如001 00.2\n                    native.toast({ msg: '请输入正确的金额' });\n                    $(this).val('');\n                } else if (val.length > 3 && parseFloat(val) < 0.01) {\n                    //错误金额 0.00\n                    native.toast({ msg: '请输入正确的金额' });\n                    $(this).val('');\n                }\n            });\n\n            //点击下一步\n            $('.js_content_sub').on('click', function () {\n                // if ($(this).attr('submiting') == 'true'){\n                //     return false;\n                // }\n                recharge_request();\n            });\n            /*************************************** private func **************************************/\n            function get_baseinfo() {\n                merchantinfo_request();\n                balance_request();\n                userInfo_request();\n            }\n\n            function recharge_request() {\n                var recharge_model = {\n                    c: getQueryParamString('c')\n                };\n                if (rule_index == 0) {\n                    //没有或者未选择活动储值金额\n                    var pay_amt = $('.js_custom_amount').val();\n                    if (pay_amt) {\n                        if (parseFloat(pay_amt) > 0 && parseFloat(pay_amt) <= 30000) {\n                            recharge_model.pay_amt = (parseFloat(pay_amt) * 100.0).toFixed(0);\n                        } else {\n                            if (parseFloat(pay_amt) > 30000) {\n                                native.toast({ msg: '目前只能输入30000以内的金额哦~' });\n                                //console.log('目前只能输入30000以内的金额哦~');\n                            } else {\n                                native.toast({ msg: '请输入正确的金额' });\n                                //console.log('请输入正确的金额');\n                            }\n                            return false;\n                        }\n                    } else {\n                        native.toast({ msg: '请选择或输入储值金额' });\n                        //console.log('请选择或输入储值金额');\n                        return false;\n                    }\n                } else {\n                    recharge_model.grid_index = rule_index;\n                }\n                var password = $('.js_password').val();\n                if (password && password.length > 0) {\n                    recharge_model.passwd = password;\n                } else {\n                    native.toast({ msg: '请输入密码' });\n                    return false;\n                }\n                $('.js_content_sub').attr('submiting', 'true');\n\n                $.ajax({\n                    url: '/prepaid/v1/api/b/mrecharge',\n                    type: 'POST',\n                    dataType: 'json',\n                    contentType: 'application/json; charset=utf-8',\n                    data: JSON.stringify(recharge_model),\n                    beforeSend: function beforeSend(XMLHttpRequest) {\n                        $('#load_small_bg').show();\n                    },\n                    success: function success(data) {\n                        if (data.respcd != '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng').show();\n                            if (!data['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(data['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(data['respmsg']);\n                            }\n                        } else {\n                            native.toast({ msg: '储值成功' });\n                            var url_val = location.protocol + '//' + location.host + '/prepaid/v1/page/b/members/detail.html?c=' + getQueryParamString('c');\n                            if_menu.goto_url(url_val);\n                            $('.js_password').val('');\n                        }\n                    },\n                    error: function error(data) {\n                        $('#alert_alert').show();\n                        $('.zheceng').show();\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function complete() {\n                        $('#load_small_bg').hide();\n                    }\n                });\n            }\n\n            function merchantinfo_request() {\n                ajax_rule.ajax_rule('/prepaid/v1/api/b/merchant_info', 'GET', 'json', '', '.zheceng2', function (respond) {\n                    $('.js_shopname').html(respond.merchant_name);\n                });\n            }\n\n            function balance_request() {\n                ajax_rule.ajax_rule('/prepaid/v1/api/b/balance', 'GET', 'json', { c: getQueryParamString('c') }, '.zheceng2', function (respond) {\n                    $('.js_balance').html((parseFloat(respond.balance) / 100.0).toFixed(2));\n                });\n            }\n\n            function userInfo_request() {\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/bindinfo', 'GET', 'json', { c: getQueryParamString('c') }, '.zheceng2', function (respond) {\n                    $('.js_mobile').html(respond.mobile);\n                });\n            }\n\n            function recharge_rules_request() {\n                ajax_rule.ajax_rule('/prepaid/v1/api/b/activity_detail', 'GET', 'json', { c: getQueryParamString('c'), noact_noerr: '' }, '.zheceng', function (respond) {\n                    if (!(respond.status == 1 && respond.rules.length > 0)) {\n                        //没有储值活动\n                        $('.s_custom_amount').addClass('selected');\n                        $('.js_custom_amount').removeAttr('readOnly');\n                    } else {\n                        //有储值活动\n                        $('.s_rules_amount').addClass('selected');\n                        var rules_dom = '<p class=\"title_a js_rules_title\"><i class=\"icon_select icon_selected\"></i> 请选择储值金额</p><ul class=\"rechage_ul js_rechage_ul\">';\n                        $.each(respond.rules, function (idx, rule) {\n                            var pay_amt = parseInt(rule.pay_amt) / 100;\n                            var present_amt = parseInt(rule.present_amt) / 100;\n                            var ruleindex = rule.grid_index;\n                            var li_dom;\n                            if (idx == 0) {\n                                rule_index = ruleindex;\n                                li_dom = '<li class=\"li_choose\" data-index=\"' + ruleindex + '\"><p class=\"font_17\">储值' + pay_amt + '元</p><p>送' + present_amt + '元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                            } else {\n                                li_dom = '<li data-index=\"' + ruleindex + '\"><p class=\"font_17\">储值' + pay_amt + '元</p><p>送' + present_amt + '元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                            }\n                            rules_dom += li_dom;\n                        });\n                        rules_dom += '</ul>';\n                        $('.js_recharge_rulediv').append(rules_dom);\n                    }\n                });\n            }\n\n            //获取查询参数\n            function getQueryParamString(name) {\n                var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n                var r = window.location.search.substr(1).match(reg);\n                if (r != null) return unescape(r[2]);\n                return null;\n            }\n        });\n    });\n});"]}
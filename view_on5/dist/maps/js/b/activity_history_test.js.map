{"version":3,"sources":["b/activity_history_test.js"],"names":["require","$","add_bounced","ajax_rule","scroll_more","date_change","append_ul","list","con_list","con_list1","b","times_add","hide","last_len","i","append","scroll_data","body_height","Math","floor","height","toFixed","nomoredata_show","window","setTimeout","nomoredata_hide","nomor_show","scroll_if","console","log","add_load_img","document","ready","close_tip"],"mappings":"AAAA,YAEAA,UAAS,qBAAsB,WAC3BA,SAAS,QAAS,cAAe,YAAa,cAAe,eAAgB,SAAUC,EAAGC,EAAaC,EAAWC,EAAaC,GAC3HJ,EAAE,WAiBE,QAASK,KACL,GAGIC,GAHAC,EAAW,yeACXC,EAAY,yeAYhB,IATS,KAALC,GACAH,EAAOE,EACPC,EAAI,IAEJH,EAAOC,EACPE,EAAI,GAGRC,IACIA,EAAY,EAAG,CACfV,EAAE,SAASW,MAGX,KAAK,GADDC,GAAW,EACNC,EAAI,EAAGA,EAAID,EAAUC,IAC1Bb,EAAE,6BAA6Bc,OAAOR,EAa1C,OAXAH,GAAYY,YAAYC,YAAcC,KAAKC,MAAMlB,EAAE,QAAQmB,UAAUC,QAAQ,GACzER,GAAY,GACZT,EAAYkB,kBACZC,OAAOC,WAAWpB,EAAYqB,gBAAiB,KAC/CrB,EAAYY,YAAYU,YAAa,GAErCtB,EAAYY,YAAYU,YAAa,EAEzCtB,EAAYY,YAAYW,WAAY,EACpCC,QAAQC,IAAI,mBAAqBzB,EAAYY,YAAYW,WACzDC,QAAQC,IAAI,oBAAsBzB,EAAYY,YAAYU,aACnD,EAGX,IAAK,GAAIZ,GAAI,EAAGA,EAAI,EAAGA,IACnBb,EAAE,6BAA6Bc,OAAOR,EAE1CN,GAAE,SAASW,OACXR,EAAYY,YAAYW,WAAY,EACpCvB,EAAYY,YAAYC,YAAcC,KAAKC,MAAMlB,EAAE,QAAQmB,UAAUC,QAAQ,GAC7EO,QAAQC,IAAI,mBAAqBzB,EAAYY,YAAYW,WACzDC,QAAQC,IAAI,oBAAsBzB,EAAYY,YAAYU,YAzD9D,GAAIhB,GAAI,EAERC,EAAY,CAEZP,GAAY0B,aAAa,QAEzB1B,EAAYA,YAAYE,GAExBL,EAAE8B,UAAUC,MAAM,WAId1B,MAoGJJ,EAAYA,cAEZA,EAAY+B","file":"../../../js/b/activity_history_test.js","sourcesContent":["\"use strict\";\n\nrequire(['../require-config'], function () {\n    require([\"zepto\", \"add_bounced\", \"ajax_rule\", \"scroll_more\", \"date_change\"], function ($, add_bounced, ajax_rule, scroll_more, date_change) {\n        $(function () {\n            //滚动加载---------------------------------------------------------------   \n            var b = 1,\n                //测试专用--变更加载数据\n            times_add = 0; //测试专用--控制停止加载数据判断依据  \n            //添加图标和没有更多文字提示\n            scroll_more.add_load_img('#wap');\n            //默认执行--测试专用    \n            scroll_more.scroll_more(append_ul);\n            //设置储值活动----------------------------------------------------------------------------------------------------------------------------------------------------\n            $(document).ready(function () {\n                //获取信息--todo\n                //get_history();\n                //测试\n                append_ul();\n            });\n            //测试\n            function append_ul() {\n                var con_list = '<section class=\"section_history\"><p class=\"time\">4645756</p><ul class=\"message\"><li>会员总<br/><span class=\"span_num\"><i class=\"js_all_person\">8</i>人</span></li><li>储值金额<br/><span class=\"span_num\"><i class=\"js_all_money\">8</i>元</span></li></ul><ul class=\"rules\"><li><span class=\"fr\"><i class=\"i_normal\">5人</i>已购买</span>储值50送5元</li><li><span class=\"fr\"><i class=\"i_normal\">12人</i>已购买</span>储值100送10元</li><li><span class=\"fr\"><i class=\"i_normal\">3人</i>已购买</span>储值300送50元</li></ul></section>';\n                var con_list1 = '<section class=\"section_history\"><p class=\"time\">09999999</p><ul class=\"message\"><li>会员总<br/><span class=\"span_num\"><i class=\"js_all_person\">8</i>人</span></li><li>储值金额<br/><span class=\"span_num\"><i class=\"js_all_money\">8</i>元</span></li></ul><ul class=\"rules\"><li><span class=\"fr\"><i class=\"i_normal\">5人</i>已购买</span>储值50送5元</li><li><span class=\"fr\"><i class=\"i_normal\">12人</i>已购买</span>储值100送10元</li><li><span class=\"fr\"><i class=\"i_normal\">3人</i>已购买</span>储值300送50元</li></ul></section>';\n\n                var list;\n                if (b == '1') {\n                    list = con_list1;\n                    b = 0;\n                } else {\n                    list = con_list;\n                    b = 1;\n                }\n                //判断终止添加数据\n                times_add++;\n                if (times_add > 3) {\n                    $('.load').hide();\n                    //最后添加的数据\n                    var last_len = 2;\n                    for (var i = 0; i < last_len; i++) {\n                        $('.js_activityhistory_index').append(list);\n                    }\n                    scroll_more.scroll_data.body_height = Math.floor($('body').height()).toFixed(0);\n                    if (last_len <= 0) {\n                        scroll_more.nomoredata_show();\n                        window.setTimeout(scroll_more.nomoredata_hide, 2000);\n                        scroll_more.scroll_data.nomor_show = false;\n                    } else {\n                        scroll_more.scroll_data.nomor_show = true;\n                    }\n                    scroll_more.scroll_data.scroll_if = false;\n                    console.log('AJAX:scroll_if==' + scroll_more.scroll_data.scroll_if);\n                    console.log('AJAX:nomor_show==' + scroll_more.scroll_data.nomor_show);\n                    return false;\n                }\n                //正常添加数据\n                for (var i = 0; i < 3; i++) {\n                    $('.js_activityhistory_index').append(list);\n                }\n                $('.load').hide();\n                scroll_more.scroll_data.scroll_if = true;\n                scroll_more.scroll_data.body_height = Math.floor($('body').height()).toFixed(0);\n                console.log('AJAX:scroll_if==' + scroll_more.scroll_data.scroll_if);\n                console.log('AJAX:nomor_show==' + scroll_more.scroll_data.nomor_show);\n                // console.log(body_height); \n            }\n            //获取活动列表\n            function get_history() {\n                var data = {\n                    'pos': $('#js_pos').val(),\n                    'count': 20\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/b/activity_history', 'GET', 'json', data, '.zheceng', get_list);\n            }\n            //获取列表成功数据\n            function get_list(return_data) {\n                $(return_data).each(function (i, item) {\n                    var startime = return_data[i].start_time;\n                    var endtime = return_data[i].end_time;\n                    var activity_id = return_data[i].activity_id;\n                    var user_num = return_data[i].user_num;\n                    var total_txamt = (return_data[i].total_txamt / 100).toFixed(0);\n                    var total_pay_amt = (return_data[i].total_pay_amt / 100).toFixed(0);\n                    var detail = return_data[i].detail; //活动信息\n                    var s_time = date_change.time_change_word(startime);\n                    var e_time = date_change.time_change_word2(startime, endtime);\n                    var p_str = '<p class=\"time\">' + s_time + '-' + e_time + '</p>';\n                    var ul_str = '<ul class=\"message\"><li>会员总<br/><span class=\"span_num\"><i class=\"js_all_person\">' + user_num + '</i>人</span></li><li>储值金额<br/><span class=\"span_num\"><i class=\"js_all_money\">' + total_pay_amt + '</i>元</span></li></ul>';\n                    var rule_str = '<ul class=\"rules\">';\n                    $(detail).each(function (i, item) {\n                        var grid_index = detail[i].grid_index;\n                        var title = detail[i].title;\n                        var user_num = detail[i].user_num;\n                        var li_str = '<li data-index=\"' + grid_index + '\"><span class=\"fr\"><i class=\"i_normal\">' + user_num + '人</i>已购买</span>' + title + '</li>';\n                        rule_str += li_str;\n                    });\n                    rule_str += '</ul>';\n                    var li_detail = '<section class=\"section_history\">' + p_str + ul_str + rule_str + '</section>';\n                    $(\".js_activityhistory_index\").append(li_detail);\n                });\n                var pos_val = $('#js_pos').val() - 0;\n                if (return_data.length < 10) {\n                    if (return_data.length > 0) {\n                        scroll_more.scroll_data.nomor_show = true;\n                    } else {\n                        scroll_more.nomoredata_show();\n                        window.setTimeout(scroll_more.nomoredata_hide, 2000);\n                        scroll_more.scroll_data.nomor_show = false;\n                    }\n                    scroll_more.scroll_data.scroll_if = false;\n                } else {\n                    pos_val += 10;\n                    $('#js_pos').val(pos_val);\n                    scroll_more.scroll_data.scroll_if = true;\n                }\n                scroll_more.scroll_data.body_height = $('body').height();\n            }\n            //添加弹框\n            add_bounced.add_bounced();\n            //关闭弹框\n            add_bounced.close_tip();\n        });\n    });\n});"]}
{"version":3,"sources":["b/manual_bindinfo.js"],"names":["require","$","ajax_rule","if_menu","native","date_day","iosselect","verifyCodeRequest","phoneNum","verifyCodeModel","c","getQueryParamString","mobile","attr","disableVerifyCode","hide","show","countdownFunc","verifyPhoneNum","num","test","highlightVerifyCode","highlightNextBut","toast","msg","addClass","parents","haveSendCode","hasClass","val","length","removeClass","clicked","time0","text","t","setTimeout","clearTimeout","num_change_long","name","reg","RegExp","r","window","location","search","substr","match","unescape","document","ready","on","this","substring","idName","indexOf","showDom","querySelector","year","dataset","month","day","time_free","start_year","end_year","nowYear","yearData","monthData","dateData","container","title","itemHeight","itemShowCount","relation","oneLevelId","twoLevelId","threeLevelId","callback","year_data","month_data","day_data","id","value","code","captcha","bindModel","birthday","url_val","protocol","host","goto_url"],"mappings":"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","file":"../../../js/b/manual_bindinfo.js","sourcesContent":["\"use strict\";\n\n/**\n * Created by liteng on 2017/5/16.\n */\n//手动储值 绑定会员信息页\nrequire(['../require-config2'], function () {\n    require([\"zepto\", \"ajax_rule\", \"if_menu\", \"native\", \"date_day\", \"iosselect\"], function ($, ajax_rule, if_menu, native, date_day, iosselect) {\n        $(function () {\n            $(document).ready(function () {\n                //获取信息--todo\n\n                //手机号输入框改变事件\n                $('.js_message_tel').on('input', function () {\n                    var val = $(this).val();\n                    if (val && val.length == 11) {\n                        //输入框刚好输入11位\n                        verifyPhoneNum(val);\n                    } else {\n                        if (val && val.length > 11) {\n                            $(this).val(val.substring(0, 11));\n                            verifyPhoneNum(val.substring(0, 11));\n                        } else {\n                            disableVerifyCode();\n                            $('.js_nextBut').addClass('disa');\n                            $('.js_message_tel').parents('dl').addClass('error_data');\n                        }\n                    }\n                });\n\n                //获取验证码点击事件\n                $('.entycode').on('click', function () {\n                    var clicked = $(this).attr('data-clicked');\n                    var idName = $(this).attr('id');\n                    if (clicked == 'true' || idName.indexOf('disable') != -1) {\n                        //验证码已经点击过 || 验证码按钮为灰色则不可用\n                        return false;\n                    }\n                    // $('.entycode').attr('data-clicked','true');\n                    // $('.entycode').attr('data-haveClick','true');\n                    // disableVerifyCode();\n                    // $('.js_get_entycode').hide();\n                    // $('.js_show_entycode').show();\n                    // countdownFunc();\n                    verifyCodeRequest($('.js_message_tel').val());\n                });\n            });\n\n            //验证码输入框事件\n            $('.js_code').on('input', function () {\n                highlightNextBut();\n                if ($(this).val().length > 6) {\n                    $(this).val($(this).val().substring(0, 6));\n                }\n            });\n\n            //姓名输入框改变事件\n            $('.js_message_name').on('input', function () {\n                var name = $(this).val();\n                if (name.length >= 2) {\n                    if (/^([\\u4e00-\\u9fa5]|[a-zA-Z0-9]){2,10}$/.test(name)) {\n                        //无特殊字符\n                        $('.js_message_name').parents('dl').removeClass('error_data');\n                        highlightNextBut();\n                    } else {\n                        $('.js_message_name').parents('dl').addClass('error_data');\n                        $('.js_nextBut').addClass('disa');\n                    }\n                } else if (name.length == 0) {\n                    $('.js_message_name').parents('dl').removeClass('error_data');\n                    highlightNextBut();\n                }\n            });\n\n            //点击生日\n            $('.js_message_birth').on('click', function () {\n                var showDom = document.querySelector('.js_message_birth');\n                var year = showDom.dataset['year'];\n                var month = showDom.dataset['month'];\n                var day = showDom.dataset['day'];\n                //设置开始和结束的年份\n                date_day.time_free.start_year = 1960;\n                date_day.time_free.end_year = date_day.nowYear;\n                var bankSelect = new iosselect(3, [date_day.yearData, date_day.monthData, date_day.dateData], {\n                    container: '.ios_select_container',\n                    title: '选择生日日期',\n                    itemHeight: 50,\n                    itemShowCount: 3,\n                    relation: [1, 1, 0, 0],\n                    oneLevelId: year,\n                    twoLevelId: month,\n                    threeLevelId: day,\n                    //showLoading: true,\n                    callback: function callback(year_data, month_data, day_data) {\n                        showDom.dataset['year'] = year_data.id;\n                        showDom.dataset['month'] = month_data.id;\n                        showDom.dataset['day'] = day_data.id;\n                        showDom.value = year_data.id + '年' + month_data.id + '月' + day_data.id + '日';\n                        $('#birthday').val(year_data.id + '-' + num_change_long(month_data.id) + '-' + num_change_long(day_data.id));\n                    }\n                });\n            });\n\n            //下一步\n            $('.js_nextBut').on('click', function () {\n                var phoneNum = $('.js_message_tel').val();\n                var code = $('.js_code').val();\n                if (verifyPhoneNum(phoneNum) && code.length > 2) {\n                    ajax_rule.ajax_rule(' /prepaid/v1/api/c/captcha', 'POST', 'json', { mobile: phoneNum, captcha: code }, '.zheceng', function () {\n                        var bindModel = {\n                            c: getQueryParamString('c'),\n                            mobile: phoneNum,\n                            captcha: code,\n                            name: '',\n                            birthday: ''\n                        };\n                        if ($('.js_message_name').val()) {\n                            bindModel.name = $('.js_message_name').val();\n                        }\n                        if ($('.js_message_birth').val()) {\n                            bindModel.birthday = $('#birthday').val();\n                        }\n                        ajax_rule.ajax_rule('/prepaid/v1/api/c/bindinfo', 'POST', 'json', bindModel, '.zheceng', function () {\n                            var url_val = location.protocol + '//' + location.host + '/prepaid/v1/page/b/mrecharge/index.html?c=' + getQueryParamString('c');\n                            if_menu.goto_url(url_val);\n                        });\n                    });\n                }\n            });\n\n            /*************************************** private func **************************************/\n\n            //获取验证码\n            function verifyCodeRequest(phoneNum) {\n                var verifyCodeModel = {\n                    c: getQueryParamString('c'), //userid\n                    mobile: phoneNum\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/captcha', 'GET', 'json', verifyCodeModel, '.zheceng', function () {\n                    $('.entycode').attr('data-clicked', 'true');\n                    $('.entycode').attr('data-haveClick', 'true');\n                    disableVerifyCode();\n                    $('.js_get_entycode').hide();\n                    $('.js_show_entycode').show();\n                    countdownFunc();\n                });\n            }\n\n            //验证手机号\n            function verifyPhoneNum(num) {\n                if (/^1[3|4|5|6|7|8][0-9]{9}$/.test(num)) {\n                    //手机号可用\n                    highlightVerifyCode();\n                    highlightNextBut();\n                    return true;\n                } else {\n                    //手机号错误\n                    disableVerifyCode();\n                    native.toast({ msg: '请输入正确的手机号' });\n                    $('.js_nextBut').addClass('disa');\n                    $('.js_message_tel').parents('dl').addClass('error_data');\n                    return false;\n                }\n            }\n\n            function highlightNextBut() {\n                var haveSendCode = $('.entycode').attr('data-haveClick');\n                if (haveSendCode == 'true' && !$('.js_message_tel').parents('dl').hasClass('error_data') && !$('.js_message_name').parents('dl').hasClass('error_data') && $('.js_code').val() && $('.js_code').val().length > 2) {\n                    $('.js_nextBut').removeClass('disa');\n                }\n            }\n\n            //验证码按钮高亮\n            function highlightVerifyCode() {\n                $('.js_message_tel').parents('dl').removeClass('error_data');\n                var clicked = $('.entycode').attr('data-clicked');\n                if (clicked == 'false') {\n                    //验证码要处于未发送状态才可以高亮\n                    $('.entycode').attr('id', 'get_entycode');\n                }\n            }\n            //验证码按钮置灰\n            function disableVerifyCode() {\n                $('.entycode').attr('id', 'get_entycode_disable');\n            }\n\n            //倒计时\n            function countdownFunc() {\n                var time0 = $('.js_show_entycode i').text();\n                $('.js_show_entycode i').text(time0 - 1);\n                t = setTimeout(function () {\n                    countdownFunc();\n                }, 1000);\n                if (time0 == 0) {\n                    clearTimeout(t);\n                    $('.entycode').attr('data-clicked', 'false');\n                    verifyPhoneNum($('.js_message_tel').val());\n                    $('.js_get_entycode').show();\n                    $('.js_show_entycode').hide();\n                    $('.js_show_entycode i').text(61);\n                }\n            }\n\n            //提起补全\n            function num_change_long(num) {\n                var num = num - 0;\n                if (num < 10) {\n                    return '0' + num;\n                } else {\n                    return num;\n                }\n            }\n\n            //获取查询参数\n            function getQueryParamString(name) {\n                var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n                var r = window.location.search.substr(1).match(reg);\n                if (r != null) return unescape(r[2]);\n                return null;\n            }\n        });\n    });\n});"]}
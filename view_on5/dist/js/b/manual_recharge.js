"use strict";require(["../require-config2"],function(){require(["zepto","ajax_rule","if_menu","native","date_day","iosselect"],function($,e,t,s,a,n){$(function(){function a(){o(),l(),c()}function n(){var e={c:i("c")};if(0==u){var a=$(".js_custom_amount").val();if(!a)return s.toast({msg:"请选择或输入储值金额"}),!1;if(!(parseFloat(a)>0&&parseFloat(a)<=3e4))return parseFloat(a)>3e4?s.toast({msg:"目前只能输入30000以内的金额哦~"}):s.toast({msg:"请输入正确的金额"}),!1;e.pay_amt=(100*parseFloat(a)).toFixed(0)}else e.grid_index=u;var n=$(".js_password").val();return n&&n.length>0?(e.passwd=n,$(".js_content_sub").attr("submiting","true"),void $.ajax({url:"/prepaid/v1/api/b/mrecharge",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),beforeSend:function(e){$("#load_small_bg").show()},success:function(e){if("0000"!=e.respcd)$("#alert_alert").show(),$(".zheceng").show(),e.respmsg?$("#alert_alert .alert_con_br").html(e.respmsg):$("#alert_alert .alert_con_br").html(e.resperr);else{s.toast({msg:"储值成功"});var a=location.protocol+"//"+location.host+"/prepaid/v1/page/b/members/detail.html?c="+i("c");t.goto_url(a),$(".js_password").val("")}},error:function(e){$("#alert_alert").show(),$(".zheceng").show(),$("#alert_alert .alert_con_br").html("网络超时!")},complete:function(){$("#load_small_bg").hide()}})):(s.toast({msg:"请输入密码"}),!1)}function o(){e.ajax_rule("/prepaid/v1/api/b/merchant_info","GET","json","",".zheceng2",function(e){$(".js_shopname").html(e.merchant_name)})}function l(){e.ajax_rule("/prepaid/v1/api/b/balance","GET","json",{c:i("c")},".zheceng2",function(e){$(".js_balance").html((parseFloat(e.balance)/100).toFixed(2))})}function c(){e.ajax_rule("/prepaid/v1/api/c/bindinfo","GET","json",{c:i("c")},".zheceng2",function(e){$(".js_mobile").html(e.mobile)})}function r(){e.ajax_rule("/prepaid/v1/api/b/activity_detail","GET","json",{c:i("c"),noact_noerr:""},".zheceng",function(e){if(1==e.status&&e.rules.length>0){$(".s_rules_amount").addClass("selected");var t='<p class="title_a js_rules_title"><i class="icon_select icon_selected"></i> 请选择储值金额</p><ul class="rechage_ul js_rechage_ul">';$.each(e.rules,function(e,s){var a,n=parseInt(s.pay_amt)/100,o=parseInt(s.present_amt)/100,l=s.grid_index;0==e?(u=l,a='<li class="li_choose" data-index="'+l+'"><p class="font_17">储值'+n+"元</p><p>送"+o+'元</p><span class="choose"><i class="choose_i"></i></span></li>'):a='<li data-index="'+l+'"><p class="font_17">储值'+n+"元</p><p>送"+o+'元</p><span class="choose"><i class="choose_i"></i></span></li>',t+=a}),t+="</ul>",$(".js_recharge_rulediv").append(t)}else $(".s_custom_amount").addClass("selected"),$(".js_custom_amount").removeAttr("readOnly")})}function i(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),s=window.location.search.substr(1).match(t);return null!=s?unescape(s[2]):null}var u=0;$(document).ready(function(){a(),r(),$(document).on("touchstart",".js_rules_title",function(){$(".s_custom_amount").removeClass("selected"),$(".js_custom_amount").attr("readOnly","readOnly"),$(".js_custom_amount").val(""),$(".s_rules_amount").addClass("selected")}),$(".js_custom_title").on("click",function(){u=0,$(".s_rules_amount").removeClass("selected"),$("li").removeClass("li_choose"),$(".s_custom_amount").addClass("selected"),$(".js_custom_amount").removeAttr("readOnly")}),$(document).on("touchstart","li",function(){return!!$(".s_rules_amount").hasClass("selected")&&($("li").removeClass("li_choose"),$(this).addClass("li_choose"),void(u=$(this).attr("data-index")))})}),$(".js_custom_amount").on("input",function(){var e=$(this).val();e.length>0&&(e=e.match(/\d+(\.\d{0,2})?/)?this.value.match(/\d+(\.\d{0,2})?/)[0]:"",$(this).val(e)),e.length>1&&"0"==e.substring(0,1)&&"0."!=e.substring(0,2)?(s.toast({msg:"请输入正确的金额"}),$(this).val("")):e.length>3&&parseFloat(e)<.01&&(s.toast({msg:"请输入正确的金额"}),$(this).val(""))}),$(".js_content_sub").on("click",function(){n()})})})});
//# sourceMappingURL=../../maps/js/b/manual_recharge.js.map

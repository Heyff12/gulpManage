{"version":3,"sources":["b/member_detail.js"],"names":["require","$","yanzheng","close_tip","if_menu","get_member","id","get_hash","ajax","url","type","dataType","data","beforeSend","show","success","respcd","html","return_data","m_img","avatar","m_mobile","mobile","m_name","name","m_times","recharge_times","m_amt","recharge_amt","toFixed","m_balance","balance","attr","text","error","complete","hide","get_rechargeli","c","pos","val","count","last_len","length","each","i","item","li_detail","dl_data_set_l","trade_listnum","tx_txamt","txamt","tx_pay_amt","pay_amt","tx_present_amt","present_amt","tx_present_amt0","tx_time","sysdtm","tx_status_status","status","tx_status","biz_type","biz_sn","bizn_has","push","append","pos_val","nomor_show","animate","opacity","window","setTimeout","nomoredata_hide","scroll_if","body_height","Math","floor","height","Array","timer_rt","window_height","innerHeight","on","url_val","location","protocol","host","goto_url","get","document","ready","e","history_top","documentElement","scrollTop","body","clearTimeout","stopPropagation"],"mappings":"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","file":"../../../js/b/member_detail.js","sourcesContent":["\"use strict\";\n\nrequire(['../require-config2'], function () {\n    require([\"zepto\", \"yanzheng\", \"close_tip\", \"if_menu\"], function ($, yanzheng, close_tip, if_menu) {\n        $(function () {\n            //流水号\n            var trade_listnum = new Array();\n            //滚动下拉-------start--------------------------------------------------------\n            var timer_rt = null;\n            var scroll_if = false;\n            var nomor_show = false;\n            var window_height = window.innerHeight;\n            var body_height = $('body').height();\n            //手动储值\n            $('.manual_but').on('click', function () {\n                var url_val = location.protocol + '//' + location.host + '/prepaid/v1/page/b/mrecharge/index.html?c=' + yanzheng.get_hash('c');\n                if_menu.goto_url(url_val);\n            });\n            //活动储值详情----------------------------------------------------------------------------------------------------------------------------------------------------\n            $('.js_member_detail').get(0) && ~function () {\n                $(document).ready(function () {\n                    //获取会员信息todo-show\n                    get_member();\n                    //获取会员消费储值列表todo-show\n                    get_rechargeli();\n                });\n            }();\n            $(window).on('scroll', function (e) {\n                //var history_top = $(document).scrollTop();\n                var history_top = document.documentElement.scrollTop || document.body.scrollTop;\n                // console.log('document.documentElement.scrollTop--'+document.documentElement.scrollTop);\n                // console.log('document.body.scrollTop--'+document.body.scrollTop);\n                // console.log(body_height - window_height);\n                // console.log(history_top);\n                if (history_top < body_height - window_height) {\n                    clearTimeout(timer_rt);\n                } else {\n                    e.stopPropagation();\n                    if (scroll_if) {\n                        $('.load').show();\n                        scroll_if = false;\n                        timer_rt = window.setTimeout(get_rechargeli, 2000);\n                    }\n                    if (nomor_show) {\n                        $(\"#nomoredata\").animate({ opacity: 0.7 }, 500, 'ease-out');\n                        window.setTimeout(nomoredata_hide, 2000);\n                        nomor_show = false;\n                    }\n                    // console.log('scroll:scroll_if=='+scroll_if);\n                    // console.log('scroll:nomor_show=='+nomor_show);\n                }\n            });\n            //获取会员信息\n            function get_member() {\n                var id = yanzheng.get_hash('c');\n                $.ajax({\n                    url: '/prepaid/v1/api/b/member/' + id,\n                    type: 'GET',\n                    dataType: 'json',\n                    data: {},\n                    beforeSend: function beforeSend() {\n                        $('#load_small_bg').show();\n                    },\n                    success: function success(data) {\n                        if (data.respcd != '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng1').show();\n                            if (!data['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(data['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(data['respmsg']);\n                            }\n                        } else {\n                            var return_data = data.data;\n                            var m_img = return_data.avatar;\n                            var m_mobile = return_data.mobile;\n                            var m_name = return_data.name;\n                            var m_times = return_data.recharge_times;\n                            var m_amt = (return_data.recharge_amt / 100).toFixed(0);\n                            var m_balance = (return_data.balance / 100).toFixed(2);\n                            $('.js_m_img').attr('src', m_img);\n                            $('.js_m_tel').text(m_mobile);\n                            $('.js_m_name').text(m_name);\n                            $('.js_m_times').text(m_times);\n                            $('.js_m_all').text(m_amt);\n                            $('.js_m_loft').text(m_balance);\n                        }\n                    },\n                    error: function error(data) {\n                        $('#alert_alert').show();\n                        $('.zheceng1').show();\n                        //$('.alert_con .alert_con_br').html('XMLHttpRequest.readyState:'+XMLHttpRequest.readyState+',XMLHttpRequest.status:'+XMLHttpRequest.status+',textStatus:'+textStatus+'!');\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function complete() {\n                        $('#load_small_bg').hide();\n                    }\n                });\n            }\n            //获取会员消费储值列表\n            function get_rechargeli() {\n                $.ajax({\n                    url: '/prepaid/v1/api/transactions',\n                    type: 'GET',\n                    dataType: 'json',\n                    data: {\n                        'c': yanzheng.get_hash('c'),\n                        'pos': $('#js_pos').val(),\n                        'count': 20\n                    },\n                    beforeSend: function beforeSend() {\n                        $('#load_small_bg').show();\n                    },\n                    success: function success(data) {\n                        if (data.respcd != '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng').show();\n                            if (!data['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(data['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(data['respmsg']);\n                            }\n                        } else {\n                            var return_data = data.data;\n                            var last_len = 0;\n                            if (!return_data || return_data.length < 1) {\n                                $('.js_empty').show();\n                            } else {\n                                $('.js_empty').hide();\n                            }\n                            $(return_data).each(function (i, item) {\n                                var dl_data_set_l = trade_listnum.length;\n\n                                var tx_txamt = (return_data[i].txamt / 100).toFixed(2);\n                                var tx_pay_amt = (return_data[i].pay_amt / 100).toFixed(2);\n                                var tx_present_amt = (return_data[i].present_amt / 100).toFixed(2);\n                                var tx_pay_amt0 = (return_data[i].pay_amt / 100).toFixed(0);\n                                var tx_present_amt0 = (return_data[i].present_amt / 100).toFixed(0);\n                                var tx_time = return_data[i].sysdtm;\n                                var tx_status_status = return_data[i].status;\n                                var tx_status = return_data[i].biz_type;\n                                var biz_sn = return_data[i].biz_sn;\n                                var li_detail;\n                                //判断流水号是否重复\n                                var bizn_has = '0';\n                                for (var i = dl_data_set_l - 1; i > 0; i--) {\n                                    if (trade_listnum[i] == biz_sn) {\n                                        bizn_has = '1';\n                                        break;\n                                    }\n                                }\n                                if (bizn_has == '1') {\n                                    //流水号存在则退出\n                                    return true;\n                                } else {\n                                    trade_listnum.push(biz_sn);\n                                    last_len++;\n                                }\n                                if (tx_status == '1') {\n                                    //储值\n                                    //li_detail = '<li><dl><dd>储值赠送<span class=\"buy_back orange\">储值' + tx_pay_amt0 + '送' + tx_present_amt0 + '</span></dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num orange\">+<i class=\"i_normal\">' + tx_present_amt + '</i></span><div class=\"clearfix\"></div></li> <li><dl><dd>储值</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num orange\">+<i class=\"i_normal\">' + tx_pay_amt + '</i></span><div class=\"clearfix\"></div></li>';\n\n                                    li_detail = '<li><dl><dd>储值</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num zeng orange\">+<i class=\"i_normal\">' + tx_pay_amt + '</i><br/><i class=\"i_normal grey\">赠送￥' + tx_present_amt + '</i></span><div class=\"clearfix\"></div></li>';\n                                } else if (tx_status == '2') {\n                                    //消费\n                                    if (tx_status_status == '4') {\n                                        //消费退款\n                                        li_detail = '<li class=\"grey\"><dl><dd>储值消费(已撤销)</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num\">-<i class=\"i_normal\">' + tx_txamt + '</i></span><div class=\"clearfix\"></div></li>';\n                                    } else {\n                                        li_detail = '<li><dl><dd>储值消费</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num\">-<i class=\"i_normal\">' + tx_txamt + '</i></span><div class=\"clearfix\"></div></li>';\n                                    }\n                                } else if (tx_status == '4') {\n                                    //手动储值\n                                    if (tx_present_amt0 > 0) {\n                                        //有赠送\n                                        li_detail = '<li><dl><dd>手动储值</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num zeng orange\">+<i class=\"i_normal\">' + tx_pay_amt + '</i><br/><i class=\"i_normal grey\">赠送￥' + tx_present_amt + '</i></span><div class=\"clearfix\"></div></li>';\n                                    } else {\n                                        //没有赠送\n                                        li_detail = '<li><dl><dd>手动储值</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num orange\">+<i class=\"i_normal\">' + tx_txamt + '</i></span><div class=\"clearfix\"></div></li>';\n                                    }\n                                } else {\n                                    //退款\n                                    li_detail = '<li><dl><dd>消费退款</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num\">+<i class=\"i_normal\">' + tx_txamt + '</i></span><div class=\"clearfix\"></div></li>';\n                                }\n                                $(\".js_ul_history\").append(li_detail);\n                            });\n                            var pos_val = $('#js_pos').val() - 0;\n                            if (return_data.length < 20) {\n                                // if(pos_val>0){\n                                //     $('.load').hide();\n                                //     $(\"#nomoredata\").animate({opacity: 0.7,}, 500,'ease-out');\n                                //     window.setTimeout(nomoredata_hide, 2000);\n                                // }  \n                                // if(pos_val>0 && last_len<=0){\n                                //     $(\"#nomoredata\").animate({opacity: 0.7,   }, 500,'ease-out');\n                                //     window.setTimeout(nomoredata_hide, 3000);                \n                                //     nomor_show=false;\n                                // }\n                                if (last_len > 0) {\n                                    nomor_show = true;\n                                } else {\n                                    $(\"#nomoredata\").animate({ opacity: 0.7 }, 500, 'ease-out');\n                                    window.setTimeout(nomoredata_hide, 3000);\n                                    nomor_show = false;\n                                }\n                                scroll_if = false;\n                            } else {\n                                pos_val += 20;\n                                $('#js_pos').val(pos_val);\n                                scroll_if = true;\n                            }\n                            $('.zheceng').hide();\n                            $('.load').hide();\n                            body_height = Math.floor($('body').height()).toFixed(0);\n                            // console.log('AJAX:body_height=='+body_height);\n                            // console.log('AJAX:scroll_if=='+scroll_if);\n                            // console.log('AJAX:nomor_show=='+nomor_show);\n                        }\n                    },\n                    error: function error(data) {\n                        $('#alert_alert').show();\n                        $('.zheceng').show();\n                        //$('.alert_con .alert_con_br').html('XMLHttpRequest.readyState:'+XMLHttpRequest.readyState+',XMLHttpRequest.status:'+XMLHttpRequest.status+',textStatus:'+textStatus+'!');\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function complete() {\n                        $('#load_small_bg').hide();\n                    }\n                });\n            }\n            //关闭弹框\n            close_tip.close_tip();\n            //隐藏没有更多信息了\n            function nomoredata_hide() {\n                $(\"#nomoredata\").animate({ opacity: 0 }, 500, 'ease-out');\n            }\n        });\n    });\n});"]}
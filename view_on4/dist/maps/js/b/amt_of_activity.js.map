{"version":3,"sources":["b/amt_of_activity.js"],"names":["require","$","ajax_rule","scroll_more","date_change","rechargeCollectRequest","data","Object","activityId","activity_id","rechargeRequestSuccess","transactionsRequest","pos","count","dataCounts","biz_type_l","attr","transactionSuccess","rechargeDict","present_amt","parseInt","pay_amt","html","datas","length","show","hide","displayCell","setLoadMoerStatus","each","idx","val","sn","biz_sn","currentSns","indexOf","status","push","cell","creatCell","append","dict","type","biz_type","name","date","sysdtm","header_url","c_avatar","title","parseFloat","toFixed","txamt","scroll_data","scroll_if","nomor_show","nomoredata_show","window","setTimeout","nomoredata_hide","body_height","height","getQueryParamString","reg","RegExp","r","location","search","substr","match","unescape","document","ready","add_load_img"],"mappings":"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","file":"../../../js/b/amt_of_activity.js","sourcesContent":["\"use strict\";\n\nrequire(['../require-config'], function () {\n    require([\"zepto\", \"ajax_rule\", \"scroll_more\", \"date_change\"], function ($, ajax_rule, scroll_more, date_change) {\n        $(function () {\n            var dataCounts = 10;\n            var currentSns = [];\n            var activityId = getQueryParamString('activity_id');\n            $(document).ready(function () {\n                //获取信息--todo\n                scroll_more.add_load_img('.js_member_list');\n                scroll_more.scroll_more(transactionsRequest);\n                rechargeCollectRequest();\n                transactionsRequest();\n            });\n            /*************************************** private func **************************************/\n            function rechargeCollectRequest() {\n                var data = new Object();\n                if (activityId) {\n                    data.activity_id = activityId;\n                }\n                ajax_rule.ajax_rule('/prepaid/v1/api/stat/recharge', 'GET', 'json', data, '.zheceng1', rechargeRequestSuccess);\n            }\n            function transactionsRequest() {\n                var data = {\n                    'pos': 0,\n                    'count': dataCounts,\n                    'biz_type_l': '1,4'\n                };\n                var pos = $('.ul_history').attr('pos');\n                data.pos = pos;\n                if (activityId) {\n                    data.activity_id = activityId;\n                }\n                ajax_rule.ajax_rule('/prepaid/v1/api/transactions', 'GET', 'json', data, '.zheceng', transactionSuccess);\n            }\n            //储值统计请求成功\n            function rechargeRequestSuccess(rechargeDict) {\n                var present_amt = '¥' + parseInt(rechargeDict.present_amt / 100);\n                var pay_amt = '¥' + parseInt(rechargeDict.pay_amt / 100);\n                $('.js_present_amt').html(present_amt);\n                $('.js_pay_amt').html(pay_amt);\n            }\n\n            //流水请求成功\n            function transactionSuccess(datas) {\n                if ((!datas || datas.length < 1) && parseInt($('.ul_history').attr('pos')) < dataCounts) {\n                    $('.js_li_none').show();\n                } else {\n                    $('.js_li_none').hide();\n                }\n                displayCell(datas);\n                setLoadMoerStatus(datas);\n            }\n            //过滤数据\n            function displayCell(datas) {\n                $('.load').hide();\n                var pos = parseInt($('.ul_history').attr('pos'));\n                pos += datas.length;\n                $('.ul_history').attr('pos', pos);\n                $.each(datas, function (idx, val) {\n                    //如果sn已经存在则过滤掉\n                    var sn = val.biz_sn;\n                    if (currentSns.indexOf(sn) == -1) {\n                        var status = val.status;\n                        //只显示交易成功的流水\n                        if (status == 1) {\n                            currentSns.push(sn);\n                            var cell = creatCell(val);\n                            $('.ul_history').append(cell);\n                        }\n                    }\n                });\n            }\n            //创建cell\n            function creatCell(dict) {\n                var type = dict.biz_type;\n                var name = dict.name;\n                var date = dict.sysdtm;\n                var header_url = dict.c_avatar;\n                var title = type == 1 ? '储值' : '储值消费';\n                title = type == 4 ? '手动储值' : title;\n                var cell = '<li class=\"js_cell\"><dl><dt><img src=' + '\"' + header_url + '\"' + '></dt><dd>' + title + '</dd><dd class=\"grey\">' + name + '</dd><dd class=\"grey\">' + date + '</dd><div class=\"clearfix\"></div></dl>';\n                var p;\n                if (type == 1) {\n                    //充值\n                    var pay_amt = parseFloat(dict.pay_amt / 100.0).toFixed(2);\n                    var present_amt = parseFloat(dict.present_amt / 100.0).toFixed(2);\n                    cell += '<p><span class=\"dark\">+' + pay_amt + '</span><br><span class=\"grey\">赠送¥' + present_amt + '</span></p></li>';\n                } else if (type == 2) {\n                    //消费\n                    var txamt = parseFloat(dict.txamt / 100.0).toFixed(2);\n                    cell += '<p><span class=\"black\">-' + txamt + '</span></p></li>';\n                } else if (type == 4) {\n                    //手动储值\n                    var pay_amt = parseFloat(dict.pay_amt / 100.0).toFixed(2);\n                    var present_amt = parseFloat(dict.present_amt / 100.0).toFixed(2);\n                    if (present_amt > 0) {\n                        //有赠送\n                        cell += '<p><span class=\"dark\">+' + pay_amt + '</span><br><span class=\"grey\">赠送¥' + present_amt + '</span></p></li>';\n                    } else {\n                        //没有赠送\n                        cell += '<p><span class=\"dark\" style=\"line-height: 1.2rem;\">+' + pay_amt + '</span></p></li>';\n                    }\n                } else {\n                    //撤销\n                    var txamt = parseFloat(dict.txamt / 100.0).toFixed(2);\n                    cell = '<li class=\"js_cell\"><dl><dt><img src=' + '\"' + header_url + '\"' + '></dt><dd class=\"lightgrey\">' + title + '</dd><dd class=\"lightgrey\">' + name + '</dd><dd class=\"lightgrey\">' + date + '</dd><div class=\"clearfix\"></div></dl><p><span class=\"lightgrey\">+' + txamt + '</span><br><span class=\"lightgrey\">-已撤销</span></p></li>';\n                }\n                return cell;\n            }\n            //检查是否可上拉加载更多\n            function setLoadMoerStatus(datas) {\n                if (datas.length == dataCounts) {\n                    scroll_more.scroll_data.scroll_if = true;\n                } else {\n                    if (datas.length > 0) {\n                        scroll_more.scroll_data.nomor_show = true;\n                    } else {\n                        scroll_more.nomoredata_show();\n                        window.setTimeout(scroll_more.nomoredata_hide, 2000);\n                        scroll_more.scroll_data.nomor_show = false;\n                    }\n                    scroll_more.scroll_data.scroll_if = false;\n                }\n                scroll_more.scroll_data.body_height = $('body').height() - 1;\n            }\n            //获取查询参数\n            function getQueryParamString(name) {\n                var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n                var r = window.location.search.substr(1).match(reg);\n                if (r != null) return unescape(r[2]);\n                return null;\n            }\n        });\n    });\n});"]}
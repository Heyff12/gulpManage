{"version":3,"sources":["b/member_listbf.js"],"names":["require","$","yanzheng","close_tip","if_menu","nomoredata_hide","animate","opacity","append_ul","list","con_list","con_list1","b","times_add","hide","last_len","i","append","body_height","Math","floor","height","toFixed","window","setTimeout","nomor_show","scroll_if","console","log","timer_rt","window_height","innerHeight","get","document","ready","on","e","history_top","documentElement","scrollTop","body","clearTimeout","stopPropagation","show"],"mappings":"AAAA,YAEAA,UAAS,sBAAuB,WAC5BA,SAAS,QAAS,WAAY,YAAa,WAAY,SAAUC,EAAGC,EAAUC,EAAWC,GACrFH,EAAE,WAoDE,QAASI,KAELJ,EAAE,eAAeK,SAAUC,QAAS,GAAK,IAAK,YAGlD,QAASC,KACL,GAGIC,GAHAC,EAAW,qUACXC,EAAY,8UAYhB,IATS,KAALC,GACAH,EAAOE,EACPC,EAAI,IAEJH,EAAOC,EACPE,EAAI,GAGRC,IACIA,EAAY,EAAG,CACfZ,EAAE,SAASa,MAGX,KAAK,GADDC,GAAW,EACNC,EAAI,EAAGA,EAAID,EAAUC,IAC1Bf,EAAE,kBAAkBgB,OAAOR,EAc/B,OAZAS,GAAcC,KAAKC,MAAMnB,EAAE,QAAQoB,UAAUC,QAAQ,GACjDP,GAAY,GAEZd,EAAE,eAAeK,SAAUC,QAAS,IAAO,IAAK,YAChDgB,OAAOC,WAAWnB,EAAiB,KACnCoB,GAAa,GAEbA,GAAa,EAEjBC,GAAY,EACZC,QAAQC,IAAI,mBAAqBF,GACjCC,QAAQC,IAAI,oBAAsBH,IAC3B,EAGX,IAAK,GAAIT,GAAI,EAAGA,EAAI,GAAIA,IACpBf,EAAE,kBAAkBgB,OAAOR,EAE/BR,GAAE,SAASa,OACXY,GAAY,EACZR,EAAcC,KAAKC,MAAMnB,EAAE,QAAQoB,UAAUC,QAAQ,GACrDK,QAAQC,IAAI,mBAAqBF,GACjCC,QAAQC,IAAI,oBAAsBH,GA5FtC,GAAII,GAAW,KACXH,GAAY,EACZd,EAAI,EACJC,EAAY,EACZY,GAAa,EAEbK,EAAgBP,OAAOQ,YACvBb,EAAcjB,EAAE,QAAQoB,QAI5BpB,GAAE,mBAAmB+B,IAAI,KAAO,WAC5B/B,EAAEgC,UAAUC,MAAM,WAGd1B,SAGRP,EAAEsB,QAAQY,GAAG,SAAU,SAAUC,GAI7B,GAAIC,GAAcJ,SAASK,gBAAgBC,WAAaN,SAASO,KAAKD,SAGlEF,GAAcnB,EAAcY,EAC5BW,aAAaZ,IAEbO,EAAEM,kBACEhB,IACAzB,EAAE,SAAS0C,OACXjB,GAAY,EACZG,EAAWN,OAAOC,WAAWhB,EAAW,MAExCiB,IACAxB,EAAE,eAAeK,SAAUC,QAAS,IAAO,IAAK,YAChDgB,OAAOC,WAAWnB,EAAiB,KACnCoB,GAAa,GAEjBE,QAAQC,IAAI,qBAAuBF,GACnCC,QAAQC,IAAI,sBAAwBH,MA2H5CtB,EAAUA","file":"../../../js/b/member_listbf.js","sourcesContent":["\"use strict\";\n\nrequire(['../require-config2'], function () {\n    require([\"zepto\", \"yanzheng\", \"close_tip\", \"if_menu\"], function ($, yanzheng, close_tip, if_menu) {\n        $(function () {\n            //点击会员列表\n            function memberto(obj) {\n                var c = $(obj).attr('data-c');\n                var url_val = location.protocol + '//' + location.host + '/prepaid/v1/page/b/members/detail.html?c=' + c;\n                if_menu.goto_url(url_val);\n            };\n            //滚动下拉-------start--------------------------------------------------------\n            var timer_rt = null;\n            var scroll_if = false;\n            var b = 1,\n                times_add = 0,\n                nomor_show = false;\n            // console.log(scroll_if);\n            var window_height = window.innerHeight;\n            var body_height = $('body').height();\n            // console.log(window_height);\n            // console.log(body_height); \n            //活动储值详情----------------------------------------------------------------------------------------------------------------------------------------------------\n            $('.js_member_list').get(0) && ~function () {\n                $(document).ready(function () {\n                    //获取会员列表todo-show\n                    //get_rechargeli();\n                    append_ul();\n                });\n            }();\n            $(window).on('scroll', function (e) {\n                // console.log(scroll_if); \n                //var history_top = $(document).scrollTop();\n                //console.log(history_top); \n                var history_top = document.documentElement.scrollTop || document.body.scrollTop;\n                // console.log('document.documentElement.scrollTop--'+document.documentElement.scrollTop);\n                // console.log('document.body.scrollTop--'+document.body.scrollTop);\n                if (history_top < body_height - window_height) {\n                    clearTimeout(timer_rt);\n                } else {\n                    e.stopPropagation();\n                    if (scroll_if) {\n                        $('.load').show();\n                        scroll_if = false;\n                        timer_rt = window.setTimeout(append_ul, 3000);\n                    }\n                    if (nomor_show) {\n                        $(\"#nomoredata\").animate({ opacity: 0.7 }, 500, 'ease-out');\n                        window.setTimeout(nomoredata_hide, 3000);\n                        nomor_show = false;\n                    }\n                    console.log('scroll:scroll_if==' + scroll_if);\n                    console.log('scroll:nomor_show==' + nomor_show);\n                }\n            });\n\n            function nomoredata_hide() {\n                //$('#nomoredata').hide();\n                $(\"#nomoredata\").animate({ opacity: 0 }, 500, 'ease-out');\n            }\n\n            function append_ul() {\n                var con_list = '<li><dl><dt><img src=\"../../../bin/static/img/wxchar.png\"></dt><dd>韩梅梅</dd><dd class=\"grey\"><i class=\"icon_tel\"></i>13189569856</dd><dd class=\"grey\">储值<span class=\"orange\">2次</span></dd><div class=\"clearfix\"></div></dl><p><span class=\"grey\">余额</span><br/><span class=\"orange\">￥<i class=\"i_normal\">35.26</i></span></p></li>';\n                var con_list1 = '<li><dl><dt><img src=\"../../../bin/static/img/ic_shop_round@3x.png\"></dt><dd>韩梅梅</dd><dd class=\"grey\"><i class=\"icon_tel\"></i>13189569856</dd><dd class=\"grey\">储值<span class=\"orange\">2次</span></dd><div class=\"clearfix\"></div></dl><p><span class=\"grey\">余额</span><br/><span class=\"orange\">￥<i class=\"i_normal\">35.26</i></span></p></li>';\n\n                var list;\n                if (b == '1') {\n                    list = con_list1;\n                    b = 0;\n                } else {\n                    list = con_list;\n                    b = 1;\n                }\n                //判断终止添加数据\n                times_add++;\n                if (times_add > 3) {\n                    $('.load').hide();\n                    //最后添加的数据\n                    var last_len = 5;\n                    for (var i = 0; i < last_len; i++) {\n                        $('.js_ul_members').append(list);\n                    }\n                    body_height = Math.floor($('body').height()).toFixed(0);\n                    if (last_len <= 0) {\n                        //$('#nomoredata').show();\n                        $(\"#nomoredata\").animate({ opacity: 0.7 }, 500, 'ease-out');\n                        window.setTimeout(nomoredata_hide, 3000);\n                        nomor_show = false;\n                    } else {\n                        nomor_show = true;\n                    }\n                    scroll_if = false;\n                    console.log('AJAX:scroll_if==' + scroll_if);\n                    console.log('AJAX:nomor_show==' + nomor_show);\n                    return false;\n                }\n                //正常添加数据\n                for (var i = 0; i < 20; i++) {\n                    $('.js_ul_members').append(list);\n                }\n                $('.load').hide();\n                scroll_if = true;\n                body_height = Math.floor($('body').height()).toFixed(0);\n                console.log('AJAX:scroll_if==' + scroll_if);\n                console.log('AJAX:nomor_show==' + nomor_show);\n                // console.log(body_height); \n            }\n            //获取会员列表\n            function get_rechargeli() {\n                $.ajax({\n                    url: '/prepaid/v1/api/b/members',\n                    type: 'GET',\n                    dataType: 'json',\n                    data: {\n                        'pos': $('#js_pos').val(),\n                        'count': 20\n                    },\n                    beforeSend: function beforeSend() {\n                        $('#loading').show();\n                        $('.zheceng').show();\n                    },\n                    success: function success(data) {\n                        if (data.respcd != '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng').show();\n                            if (!data['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(data['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(data['respmsg']);\n                            }\n                        } else {\n                            var return_data = data.data;\n                            $(return_data).each(function (i, item) {\n                                var cz_avatar = return_data[i].avatar;\n                                var cz_recharge_times = return_data[i].recharge_times;\n                                var cz_mobile = return_data[i].mobile;\n                                var cz_name = return_data[i].name;\n                                var cz_balance = (return_data[i].balance / 100).toFixed(2);\n                                var cz_c = return_data[i].c;\n                                var li_detail = '<li data-c=\"' + cz_c + '\" onclick=\"memberto(this)\"><dl><dt><img src=\"' + cz_avatar + '\"></dt><dd>' + cz_name + '</dd><dd class=\"grey\"><i class=\"icon_tel\"></i>' + cz_mobile + '</dd><dd class=\"grey\">储值<span class=\"orange\">' + cz_recharge_times + '次</span></dd><div class=\"clearfix\"></div></dl><p><span class=\"grey\">余额</span><br/><span class=\"orange\">￥<i class=\"i_normal\">' + cz_balance + '</i></span></p></li>';\n                                $(\".js_ul_members\").append(li_detail);\n                            });\n                            var pos_val = $('#js_pos').val() - 0;\n                            if (return_data.length < 20) {\n                                if (pos_val > 0) {\n                                    $('.load').hide();\n                                    $(\"#nomoredata\").animate({ opacity: 0.7 }, 500, 'ease-out');\n                                    window.setTimeout(nomoredata_hide, 2000);\n                                }\n                                // $('#alert_alert').show();\n                                // $('#alert_alert .alert_con_br').html('数据已加载完毕');\n                                // $('.zheceng1').show();\n                                scroll_if = false;\n                            } else {\n                                pos_val += 20;\n                                $('#js_pos').val(pos_val);\n                                scroll_if = true;\n                            }\n                            $('.zheceng').hide();\n                            $('.load').hide();\n                            body_height = $('body').height();\n                        }\n                    },\n                    error: function error(data) {\n                        $('#alert_alert').show();\n                        $('.zheceng').show();\n                        //$('.alert_con .alert_con_br').html('XMLHttpRequest.readyState:'+XMLHttpRequest.readyState+',XMLHttpRequest.status:'+XMLHttpRequest.status+',textStatus:'+textStatus+'!');\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function complete() {\n                        $('#loading').hide();\n                    }\n                });\n            }\n            //关闭弹框\n            close_tip.close_tip();\n        });\n    });\n});"]}
{"version":3,"sources":["b/activity_detail__temp.js"],"names":["require","$","yanzheng","close_tip","append_ul","list","con_list","con_list1","b","i","append","hide","scroll_if","body_height","Math","floor","height","toFixed","timer_rt","window_height","window","innerHeight","map","this","attr","get","document","ready","on","e","history_top","documentElement","scrollTop","body","clearTimeout","stopPropagation","show","setTimeout"],"mappings":"AAAA,YAEAA,UAAS,qBAAsB,WAC3BA,SAAS,QAAS,WAAY,aAAc,SAAUC,EAAGC,EAAUC,GAC/DF,EAAE,WAqCE,QAASG,KACL,GAEIC,GAFAC,EAAW,uUACXC,EAAY,4TAEP,MAALC,GACAH,EAAOC,EACPE,EAAI,IAEJH,EAAOE,EACPC,EAAI,EAER,KAAK,GAAIC,GAAI,EAAGA,EAAI,GAAIA,IACpBR,EAAE,kBAAkBS,OAAOL,EAE/BJ,GAAE,SAASU,OACXC,GAAY,EAEZC,EAAcC,KAAKC,MAAMd,EAAE,QAAQe,UAAUC,QAAQ,GApDzD,GAAIC,GAAW,KACXN,GAAY,EACZJ,EAAI,EACJW,EAAgBC,OAAOC,YACvBR,EAAcZ,EAAE,QAAQe,QAIdf,GAAE,cAAcqB,IAAI,WAC9B,MAAOrB,GAAEsB,MAAMC,KAAK,eAIxBvB,GAAE,uBAAuBwB,IAAI,KAAO,WAChCxB,EAAEyB,UAAUC,MAAM,WAKdvB,MAEJH,EAAEmB,QAAQQ,GAAG,SAAU,SAAUC,GAG7B,GAAIC,GAAcJ,SAASK,gBAAgBC,WAAaN,SAASO,KAAKD,SAClEF,GAAcjB,EAAcM,EAC5Be,aAAahB,GACNN,IACPiB,EAAEM,kBACFlC,EAAE,SAASmC,OACXxB,GAAY,EACZM,EAAWE,OAAOiB,WAAWjC,EAAW,WA8JpDD,EAAUA","file":"../../../js/b/activity_detail__temp.js","sourcesContent":["\"use strict\";\n\nrequire(['../require-config'], function () {\n    require([\"zepto\", \"yanzheng\", \"close_tip\"], function ($, yanzheng, close_tip) {\n        $(function () {\n            //滚动下拉-------start--------------------------------------------------------\n            var timer_rt = null;\n            var scroll_if = false;\n            var b = 1;\n            var window_height = window.innerHeight;\n            var body_height = $('body').height();\n            // console.log(window_height);\n            // console.log(body_height); \n\n            var dl_data = $(\".js_datadl\").map(function () {\n                return $(this).attr('data-bizsn');\n            });\n            //var dl_data_set = new Set(dl_data.get(0));     \n            //活动储值详情----------------------------------------------------------------------------------------------------------------------------------------------------\n            $('.js_activity_detail').get(0) && ~function () {\n                $(document).ready(function () {\n                    //获取当前活动充值统计todo-show\n                    //get_recharge();\n                    //获取当前活动充值流水\n                    //get_rechargeli();\n                    append_ul();\n                });\n                $(window).on('scroll', function (e) {\n                    //var history_top = $(document).scrollTop();\n                    //var history_top = document.documentElement.scrollTop || document.body.scrollTop;\n                    var history_top = document.documentElement.scrollTop || document.body.scrollTop;\n                    if (history_top < body_height - window_height) {\n                        clearTimeout(timer_rt);\n                    } else if (scroll_if) {\n                        e.stopPropagation();\n                        $('.load').show();\n                        scroll_if = false;\n                        timer_rt = window.setTimeout(append_ul, 3000);\n                    }\n                });\n            }();\n            function append_ul() {\n                var con_list = '<li class=\"js_datadl\" data-bizsn=\"\"><dl><dt><img src=\"../../bin/static/img/ic_shop_round@3x.png\"></dt><dd>储值赠送<span class=\"buy_back orange\">储值50送5</span></dd><dd class=\"grey\">2016-08-10 15:06:55</dd><div class=\"clearfix\"></div></dl><span class=\"history_num\">￥<i class=\"i_normal\">5</i></span><div class=\"clearfix\"></div></li>';\n                var con_list1 = '<li class=\"js_datadl\" data-bizsn=\"\"><dl><dt><img src=\"../../bin/static/img/wxchar.png\"></dt><dd>储值赠送<span class=\"buy_back orange\">储值50送5</span></dd><dd class=\"grey\">2016-08-10 15:06:55</dd><div class=\"clearfix\"></div></dl><span class=\"history_num\">￥<i class=\"i_normal\">5</i></span><div class=\"clearfix\"></div></li>';\n                var list;\n                if (b == '1') {\n                    list = con_list;\n                    b = 0;\n                } else {\n                    list = con_list1;\n                    b = 1;\n                }\n                for (var i = 0; i < 20; i++) {\n                    $('.js_ul_history').append(list);\n                }\n                $('.load').hide();\n                scroll_if = true;\n                //body_height = $('body').height();\n                body_height = Math.floor($('body').height()).toFixed(0);\n                //console.log(body_height); \n            }\n            //滚动下拉-------end--------------------------------------------------------\n\n            //获取当前活动充值统计\n            function get_recharge() {\n                $.ajax({\n                    url: '/prepaid/v1/api/stat/recharge',\n                    type: 'GET',\n                    dataType: 'json',\n                    data: {\n                        //'activity_id':yanzheng.get_hash('activity_id'),\n                    },\n                    beforeSend: function beforeSend() {\n                        $('#loading').show();\n                        $('.zheceng1').show();\n                    },\n                    success: function success(data) {\n                        if (data.respcd != '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng1').show();\n                            if (!data['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(data['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(data['respmsg']);\n                            }\n                        } else {\n                            var return_data = data.data;\n                            var money = (return_data.present_amt / 100).toFixed(0);\n                            var allmoney = (return_data.pay_amt / 100).toFixed(0);\n                            $('.js_money').text(money);\n                            $('.js_allmoney').text(allmoney);\n                            $('.zheceng1').hide();\n                        }\n                    },\n                    error: function error(data) {\n                        $('#alert_alert').show();\n                        $('.zheceng1').show();\n                        //$('.alert_con .alert_con_br').html('XMLHttpRequest.readyState:'+XMLHttpRequest.readyState+',XMLHttpRequest.status:'+XMLHttpRequest.status+',textStatus:'+textStatus+'!');\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function complete() {\n                        $('#loading').hide();\n                    }\n                });\n            }\n            //获取当前活动充值流水\n            function get_rechargeli() {\n                $.ajax({\n                    url: '/prepaid/v1/api/transactions',\n                    type: 'GET',\n                    dataType: 'json',\n                    data: {\n                        'biz_type_l': 1,\n                        //'activity_id':yanzheng.get_hash('activity_id'),\n                        'pos': $('#js_pos').val(),\n                        'count': 20\n                    },\n                    beforeSend: function beforeSend() {\n                        $('#loading').show();\n                        $('.zheceng').show();\n                    },\n                    success: function success(data) {\n                        if (data.respcd != '0000') {\n                            $('#alert_alert').show();\n                            $('.zheceng').show();\n                            if (!data['respmsg']) {\n                                $('#alert_alert .alert_con_br').html(data['resperr']);\n                            } else {\n                                $('#alert_alert .alert_con_br').html(data['respmsg']);\n                            }\n                        } else {\n                            var return_data = data.data;\n                            $(return_data).each(function (i, item) {\n                                var dl_data = $(\".js_datadl\").map(function () {\n                                    return $(this).attr('data-bizsn');\n                                }).get();\n                                var dl_data_set_l = dl_data.length;\n                                var tx_txamt = (return_data[i].txamt / 100).toFixed(2);\n                                var tx_pay_amt = (return_data[i].pay_amt / 100).toFixed(2);\n                                var tx_present_amt = (return_data[i].present_amt / 100).toFixed(2);\n                                var tx_pay_amt0 = (return_data[i].pay_amt / 100).toFixed(0);\n                                var tx_present_amt0 = (return_data[i].present_amt / 100).toFixed(0);\n                                var tx_img = return_data[i].c_avatar;\n                                var tx_time = return_data[i].sysdtm;\n                                var tx_status = return_data[i].biz_type;\n                                var biz_sn = return_data[i].biz_sn;\n                                var tx_name, tx_price;\n                                var li_detail;\n                                //判断流水号是否重复\n                                var bizn_has = '0';\n                                for (var i = dl_data_set_l - 1; i > 0; i--) {\n                                    if (dl_data[i] == biz_sn) {\n                                        bizn_has = '1';\n                                        break;\n                                    }\n                                }\n                                if (bizn_has == '1') {\n                                    return true;\n                                }\n                                li_detail = '<li class=\"js_datadl\" data-bizsn=\"' + biz_sn + '\"><dl><dt><img src=\"' + tx_img + '\"></dt><dd>储值赠送<span class=\"buy_back orange\">储值' + tx_pay_amt0 + '送' + tx_present_amt0 + '</span></dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num\">￥<i class=\"i_normal\">' + tx_present_amt0 + '</i></span><div class=\"clearfix\"></div></li><li><dl><dt><img src=\"' + tx_img + '\"></dt><dd>储值</dd><dd class=\"grey\">' + tx_time + '</dd><div class=\"clearfix\"></div></dl><span class=\"history_num\">￥<i class=\"i_normal\">' + tx_pay_amt0 + '</i></span><div class=\"clearfix\"></div></li>';\n\n                                $(\".js_ul_history\").append(li_detail);\n                            });\n                            var pos_val = $('#js_pos').val() - 0;\n                            if (return_data.length < 20) {\n                                $('#alert_alert').show();\n                                $('#alert_alert .alert_con_br').html('数据已加载完毕');\n                                $('.zheceng1').show();\n                                scroll_if = false;\n                                //$('.js_click_more').hide();\n                            } else {\n                                //$('.js_click_more').show();\n                                pos_val += 20;\n                                $('#js_pos').val(pos_val);\n                                scroll_if = true;\n                            }\n                            $('.zheceng').hide();\n                            $('.load').hide();\n                            //body_height = $('body').height();\n                            body_height = Math.floor($('body').height()).toFixed(0);\n                            console.log(scroll_if);\n                        }\n                    },\n                    error: function error(data) {\n                        $('#alert_alert').show();\n                        $('.zheceng').show();\n                        //$('.alert_con .alert_con_br').html('XMLHttpRequest.readyState:'+XMLHttpRequest.readyState+',XMLHttpRequest.status:'+XMLHttpRequest.status+',textStatus:'+textStatus+'!');\n                        $('#alert_alert .alert_con_br').html('网络超时!');\n                    },\n                    complete: function complete() {\n                        $('#loading').hide();\n                    }\n                });\n            }\n            //关闭弹框\n            close_tip.close_tip();\n        });\n    });\n});"]}
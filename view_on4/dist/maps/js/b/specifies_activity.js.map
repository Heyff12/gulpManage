{"version":3,"sources":["b/specifies_activity.js"],"names":["require","$","ajax_rule","scroll_more","date_change","if_menu","requestActivityMemenberList","data","pos","count","activityId","getQueryParamString","activity_id","requestSuccess","length","show","hide","dataManager","dataSource","reloadDisplayDatas","creatCell","displayDatas","setLoadMoerState","loadMoerAction","filterData","key","scroll_data","body_height","height","searchDatas","splice","reg","RegExp","each","idx","val","test","mobile","name","push","empty","header_img_url","c","avatar","times","recharge_times","balance","parseFloat","recharge_amt","toFixed","cell","append","on","this","attr","url_val","location","protocol","host","goto_url","canLoadMoer","scroll_if","nomor_show","nomoredata_show","window","setTimeout","nomoredata_hide","isLoadMoer","currentCounts","dataCount","r","search","substr","match","unescape","document","ready","value","add_load_img"],"mappings":"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","file":"../../../js/b/specifies_activity.js","sourcesContent":["\"use strict\";\n\nrequire(['../require-config2'], function () {\n    require([\"zepto\", \"ajax_rule\", \"scroll_more\", \"date_change\", \"if_menu\"], function ($, ajax_rule, scroll_more, date_change, if_menu) {\n        $(function () {\n\n            var dataManager = {\n                'dataSource': [],\n                'displayDatas': [],\n                'searchDatas': [],\n                'canLoadMoer': false\n            };\n            var dataCount = 10;\n            $(document).ready(function () {\n                $('.js_searchbox').on('input', function (value) {\n                    var value = $('.js_searchbox').val();\n                    if (value.length > 0) {\n                        filterData(value);\n                    } else {\n                        creatCell(dataManager.displayDatas);\n                        setLoadMoerState();\n                    }\n                });\n                //获取信息--todo\n                scroll_more.add_load_img('.js_member_list');\n                scroll_more.scroll_more(loadMoerAction);\n                requestActivityMemenberList();\n            });\n            /*************************************** private func **************************************/\n            function requestActivityMemenberList() {\n                var data = {\n                    'pos': 0,\n                    'count': 999\n                };\n                var activityId = getQueryParamString('activity_id');\n                if (activityId) {\n                    data.activity_id = activityId;\n                }\n                ajax_rule.ajax_rule('/prepaid/v1/api/b/members', 'GET', 'json', data, '.zheceng', requestSuccess);\n            }\n\n            function requestSuccess(data) {\n                if (!data || data.length < 1) {\n                    $('.js_li_none').show();\n                } else {\n                    $('.js_li_none').hide();\n                }\n                dataManager.dataSource = data;\n                reloadDisplayDatas(false);\n                creatCell(dataManager.displayDatas);\n                setLoadMoerState();\n            }\n\n            function loadMoerAction() {\n                reloadDisplayDatas(true);\n                creatCell(dataManager.displayDatas);\n                $('.load').hide();\n                setLoadMoerState();\n            }\n\n            function filterData(key) {\n                scroll_more.scroll_data.body_height = $('body').height() + 1;\n                dataManager.searchDatas.splice(0, dataManager.searchDatas.length);\n                var reg = new RegExp(key);\n                $.each(dataManager.dataSource, function (idx, val) {\n                    if (reg.test(val.mobile) || reg.test(val.name)) {\n                        dataManager.searchDatas.push(val);\n                    }\n                });\n                creatCell(dataManager.searchDatas);\n            }\n\n            //创建cell\n            function creatCell(displayDatas) {\n                $('.ul_history').empty();\n                $.each(displayDatas, function (idx, val) {\n                    var cid = val.c;\n                    var header_img_url = val.avatar;\n                    var mobile = val.mobile;\n                    var name = val.name;\n                    var times = val.recharge_times + '次';\n                    var amount = parseFloat(val.recharge_amt / 100.0).toFixed(2);\n                    var balance = parseFloat(val.balance / 100.0).toFixed(2);\n                    var cell = '<li class=\"js_cell\"' + ' user_c=' + '\"' + val.c + '\"' + '><dl><dt><img src=' + '\"' + header_img_url + '\"' + '></dt><dd>' + name + '</dd><dd class=\"grey\"><i class=\"icon_tel\"></i>' + mobile + '</dd><dd class=\"grey\">储值 <span class=\"orange\">' + times + '</span></dd><div class=\"clearfix\"></div></dl><p><span class=\"grey\">余额</span><br/><span class=\"orange\">￥<i class=\"i_normal\">' + balance + '</i></span></p></li>';\n                    $('.ul_history').append(cell);\n                });\n                $('.js_cell').on('click', function () {\n                    var c = $(this).attr('user_c');\n                    if (c) {\n                        var url_val = location.protocol + '//' + location.host + '/prepaid/v1/page/b/members/detail.html?c=' + c;\n                        if_menu.goto_url(url_val);\n                    }\n                });\n            }\n\n            //显示加载更多\n            function setLoadMoerState() {\n                if (dataManager.canLoadMoer) {\n                    scroll_more.scroll_data.scroll_if = true;\n                } else {\n                    if (dataManager.displayDatas.length > 0) {\n                        scroll_more.scroll_data.nomor_show = true;\n                    } else {\n                        scroll_more.nomoredata_show();\n                        window.setTimeout(scroll_more.nomoredata_hide, 2000);\n                        scroll_more.scroll_data.nomor_show = false;\n                    }\n                    scroll_more.scroll_data.scroll_if = false;\n                }\n                scroll_more.scroll_data.body_height = $('body').height() - 1;\n            }\n\n            //更新显示数据源\n            function reloadDisplayDatas(isLoadMoer) {\n                if (!isLoadMoer) {\n                    if (dataManager.dataSource.length < dataCount) {\n                        $.each(dataManager.dataSource, function (idx, val) {\n                            dataManager.displayDatas.push(val);\n                        });\n                    } else {\n                        dataManager.canLoadMoer = true;\n                        $.each(dataManager.dataSource, function (idx, val) {\n                            if (idx < dataCount) {\n                                dataManager.displayDatas.push(val);\n                            }\n                        });\n                    }\n                } else {\n                    //上拉加载\n                    var currentCounts = dataManager.displayDatas.length;\n                    $.each(dataManager.dataSource, function (idx, val) {\n                        if (idx >= dataManager.displayDatas.length && idx < currentCounts + dataCount) {\n                            dataManager.displayDatas.push(val);\n                        }\n                    });\n                    if (dataManager.displayDatas.length % dataCount != 0) {\n                        //已经没有更多数据了\n                        scroll_more.nomor_show = true;\n                        dataManager.canLoadMoer = false;\n                    } else {\n                        scroll_more.nomor_show = false;\n                        dataManager.canLoadMoer = true;\n                    }\n                }\n            }\n\n            //获取查询参数\n            function getQueryParamString(name) {\n                var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n                var r = window.location.search.substr(1).match(reg);\n                if (r != null) return unescape(r[2]);\n                return null;\n            }\n        });\n    });\n});"]}
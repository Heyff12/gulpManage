{"version":3,"sources":["b/bill.js"],"names":["require","$","ajax_rule","scroll_more","date_change","transactionsRequest","data","pos","count","dataCounts","activityId","getQueryParamString","attr","activity_id","requestSuccess","datas","length","parseInt","show","hide","console","log","currentSns","displayCell","setLoadMoerStatus","each","idx","val","sn","biz_sn","indexOf","status","push","cell","creatCell","append","dict","type","biz_type","name","date","sysdtm","header_url","c_avatar","title","pay_amt","parseFloat","toFixed","present_amt","txamt","scroll_data","scroll_if","nomor_show","nomoredata_show","window","setTimeout","nomoredata_hide","body_height","height","reg","RegExp","r","location","search","substr","match","unescape","document","ready","add_load_img"],"mappings":"AAAA,YAEAA,UAAS,qBAAsB,WAC3BA,SAAS,QAAS,YAAa,cAAe,eAAgB,SAAUC,EAAGC,EAAWC,EAAaC,GAC/FH,EAAE,WAUE,QAASI,KACL,GAAIC,IACAC,IAAO,EACPC,MAASC,GAETC,EAAaC,EAAoB,eACjCJ,EAAMN,EAAE,eAAeW,KAAK,MAChCN,GAAKC,IAAMA,EACPG,IACAJ,EAAKO,YAAcH,GAEvBR,EAAUA,UAAU,+BAAgC,MAAO,OAAQI,EAAM,WAAYQ,GAGzF,QAASA,GAAeC,KACdA,GAASA,EAAMC,OAAS,IAAMC,SAAShB,EAAE,eAAeW,KAAK,QAAUH,EACzER,EAAE,eAAeiB,OAEjBjB,EAAE,eAAekB,OAErBC,QAAQC,IAAIC,GACZC,EAAYR,GACZS,EAAkBT,GAGtB,QAASQ,GAAYR,GACjBd,EAAE,SAASkB,MACX,IAAIZ,GAAMU,SAAShB,EAAE,eAAeW,KAAK,OACzCL,IAAOQ,EAAMC,OACbf,EAAE,eAAeW,KAAK,MAAOL,GAC7BN,EAAEwB,KAAKV,EAAO,SAAUW,EAAKC,GAEzB,GAAIC,GAAKD,EAAIE,MACb,IAAIP,EAAWQ,QAAQF,KAAO,EAAI,CAC9B,GAAIG,GAASJ,EAAII,MAEjB,IAAc,GAAVA,EAAa,CACbT,EAAWU,KAAKJ,EAChB,IAAIK,GAAOC,EAAUP,EACrB1B,GAAE,eAAekC,OAAOF,OAMxC,QAASC,GAAUE,GACf,GAAIC,GAAOD,EAAKE,SACZC,EAAOH,EAAKG,KACZC,EAAOJ,EAAKK,OACZC,EAAaN,EAAKO,SAClBC,EAAgB,GAARP,EAAY,KAAO,MAC/BO,GAAgB,GAARP,EAAY,OAASO,CAC7B,IAAIX,GAAO,yCAAgDS,EAAa,cAAqBE,EAAQ,yBAA2BL,EAAO,yBAA2BC,EAAO,wCAEzK,IAAY,GAARH,EAAW,CAEX,GAAIQ,GAAUC,WAAWV,EAAKS,QAAU,KAAOE,QAAQ,GACnDC,EAAcF,WAAWV,EAAKY,YAAc,KAAOD,QAAQ,EAC/Dd,IAAQ,4BAA8BY,EAAU,oCAAsCG,EAAc,uBACjG,IAAY,GAARX,EAAW,CAElB,GAAIY,GAAQH,WAAWV,EAAKa,MAAQ,KAAOF,QAAQ,EACnDd,IAAQ,2BAA6BgB,EAAQ,uBAC1C,IAAY,GAARZ,EAAW,CAElB,GAAIQ,GAAUC,WAAWV,EAAKS,QAAU,KAAOE,QAAQ,GACnDC,EAAcF,WAAWV,EAAKY,YAAc,KAAOD,QAAQ,EAG3Dd,IAFAe,EAAc,EAEN,4BAA8BH,EAAU,oCAAsCG,EAAc,mBAG5F,wDAA0DH,EAAU,uBAE7E,CAEH,GAAII,GAAQH,WAAWV,EAAKa,MAAQ,KAAOF,QAAQ,EACnDd,GAAO,yCAAgDS,EAAa,gCAAuCE,EAAQ,6CAA+CL,EAAO,6CAA+CC,EAAO,qEAAuES,EAAQ,yDAElT,MAAOhB,GAGX,QAAST,GAAkBT,GACnBA,EAAMC,QAAUP,EAChBN,EAAY+C,YAAYC,WAAY,GAEhCpC,EAAMC,OAAS,EACfb,EAAY+C,YAAYE,YAAa,GAErCjD,EAAYkD,kBACZC,OAAOC,WAAWpD,EAAYqD,gBAAiB,KAC/CrD,EAAY+C,YAAYE,YAAa,GAEzCjD,EAAY+C,YAAYC,WAAY,GAExChD,EAAY+C,YAAYO,YAAcxD,EAAE,QAAQyD,SAAW,EAG/D,QAAS/C,GAAoB4B,GACzB,GAAIoB,GAAM,GAAIC,QAAO,QAAUrB,EAAO,iBAClCsB,EAAIP,OAAOQ,SAASC,OAAOC,OAAO,GAAGC,MAAMN,EAC/C,OAAS,OAALE,EAAkBK,SAASL,EAAE,IAC1B,KA/GX,GAAIpD,GAAa,GACba,IACJrB,GAAEkE,UAAUC,MAAM,WAEdjE,EAAYkE,aAAa,mBACzBlE,EAAYA,YAAYE,GACxBA","file":"../../../js/b/bill.js","sourcesContent":["\"use strict\";\n\nrequire(['../require-config'], function () {\n    require([\"zepto\", \"ajax_rule\", \"scroll_more\", \"date_change\"], function ($, ajax_rule, scroll_more, date_change) {\n        $(function () {\n            var dataCounts = 10;\n            var currentSns = [];\n            $(document).ready(function () {\n                //获取信息--todo\n                scroll_more.add_load_img('.js_member_list');\n                scroll_more.scroll_more(transactionsRequest);\n                transactionsRequest();\n            });\n            /*************************************** private func **************************************/\n            function transactionsRequest() {\n                var data = {\n                    'pos': 0,\n                    'count': dataCounts\n                };\n                var activityId = getQueryParamString('activity_id');\n                var pos = $('.ul_history').attr('pos');\n                data.pos = pos;\n                if (activityId) {\n                    data.activity_id = activityId;\n                }\n                ajax_rule.ajax_rule('/prepaid/v1/api/transactions', 'GET', 'json', data, '.zheceng', requestSuccess);\n            }\n            //请求成功\n            function requestSuccess(datas) {\n                if ((!datas || datas.length < 1) && parseInt($('.ul_history').attr('pos')) < dataCounts) {\n                    $('.js_li_none').show();\n                } else {\n                    $('.js_li_none').hide();\n                }\n                console.log(currentSns);\n                displayCell(datas);\n                setLoadMoerStatus(datas);\n            }\n            //过滤数据\n            function displayCell(datas) {\n                $('.load').hide();\n                var pos = parseInt($('.ul_history').attr('pos'));\n                pos += datas.length;\n                $('.ul_history').attr('pos', pos);\n                $.each(datas, function (idx, val) {\n                    //如果sn已经存在则过滤掉\n                    var sn = val.biz_sn;\n                    if (currentSns.indexOf(sn) == -1) {\n                        var status = val.status;\n                        //只显示交易成功的流水\n                        if (status == 1) {\n                            currentSns.push(sn);\n                            var cell = creatCell(val);\n                            $('.ul_history').append(cell);\n                        }\n                    }\n                });\n            }\n            //创建cell\n            function creatCell(dict) {\n                var type = dict.biz_type;\n                var name = dict.name;\n                var date = dict.sysdtm;\n                var header_url = dict.c_avatar;\n                var title = type == 1 ? '储值' : '储值消费';\n                title = type == 4 ? '手动储值' : title;\n                var cell = '<li class=\"js_cell\"><dl><dt><img src=' + '\"' + header_url + '\"' + '></dt><dd>' + title + '</dd><dd class=\"grey\">' + name + '</dd><dd class=\"grey\">' + date + '</dd><div class=\"clearfix\"></div></dl>';\n                var p;\n                if (type == 1) {\n                    //充值\n                    var pay_amt = parseFloat(dict.pay_amt / 100.0).toFixed(2);\n                    var present_amt = parseFloat(dict.present_amt / 100.0).toFixed(2);\n                    cell += '<p><span class=\"orange\">+' + pay_amt + '</span><br><span class=\"grey\">赠送¥' + present_amt + '</span></p></li>';\n                } else if (type == 2) {\n                    //消费\n                    var txamt = parseFloat(dict.txamt / 100.0).toFixed(2);\n                    cell += '<p><span class=\"black\">-' + txamt + '</span></p></li>';\n                } else if (type == 4) {\n                    //手动储值\n                    var pay_amt = parseFloat(dict.pay_amt / 100.0).toFixed(2);\n                    var present_amt = parseFloat(dict.present_amt / 100.0).toFixed(2);\n                    if (present_amt > 0) {\n                        //有赠送\n                        cell += '<p><span class=\"orange\">+' + pay_amt + '</span><br><span class=\"grey\">赠送¥' + present_amt + '</span></p></li>';\n                    } else {\n                        //没有赠送\n                        cell += '<p><span class=\"orange\" style=\"line-height: 1.2rem\">+' + pay_amt + '</span></p></li>';\n                    }\n                } else {\n                    //撤销\n                    var txamt = parseFloat(dict.txamt / 100.0).toFixed(2);\n                    cell = '<li class=\"js_cell\"><dl><dt><img src=' + '\"' + header_url + '\"' + '></dt><dd class=\"lightgrey\">' + title + '</dd><dd class=\"lightgrey lightgrey_font\">' + name + '</dd><dd class=\"lightgrey lightgrey_font\">' + date + '</dd><div class=\"clearfix\"></div></dl><p><span class=\"lightgrey\">-' + txamt + '</span><br><span class=\"lightgrey\">已撤销</span></p></li>';\n                }\n                return cell;\n            }\n            //检查是否可上拉加载更多\n            function setLoadMoerStatus(datas) {\n                if (datas.length == dataCounts) {\n                    scroll_more.scroll_data.scroll_if = true;\n                } else {\n                    if (datas.length > 0) {\n                        scroll_more.scroll_data.nomor_show = true;\n                    } else {\n                        scroll_more.nomoredata_show();\n                        window.setTimeout(scroll_more.nomoredata_hide, 2000);\n                        scroll_more.scroll_data.nomor_show = false;\n                    }\n                    scroll_more.scroll_data.scroll_if = false;\n                }\n                scroll_more.scroll_data.body_height = $('body').height() - 1;\n            }\n            //获取查询参数\n            function getQueryParamString(name) {\n                var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n                var r = window.location.search.substr(1).match(reg);\n                if (r != null) return unescape(r[2]);\n                return null;\n            }\n        });\n    });\n});"]}
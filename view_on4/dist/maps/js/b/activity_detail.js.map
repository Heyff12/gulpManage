{"version":3,"sources":["b/activity_detail.js"],"names":["require","$","ajax_rule","scroll_more","date_change","if_menu","activity_detail_request","data","Object","activityId","getQueryParamString","activity_id","request_success","configur_alert_action","on","hide","stop_activity_success","detailDict","statusStr","status","statusColor","toggle","countdown_day","addClass","html","startTime","splitDateString","info","start_time","endTime","end_time","updateTime","update_time","attr","remove","configurRules","rules","desc","i","length","rule","pay_amt","parseInt","present_amt","ruleStr","cell","append","dateStr","strings","split","name","reg","RegExp","r","window","location","search","substr","match","unescape","document","ready","url_val","protocol","host","goto_url"],"mappings":"AAAA,YAEAA,UAAS,qBAAsB,WAC3BA,SAAS,QAAS,YAAa,cAAe,cAAe,WAAY,SAAUC,EAAGC,EAAWC,EAAaC,EAAaC,GACvHJ,EAAE,WAeE,QAASK,KACL,GAAIC,GAAO,GAAIC,QACXC,EAAaC,EAAoB,cACjCD,KACAF,EAAKI,YAAcF,GAEvBP,EAAUA,UAAU,oCAAqC,MAAO,OAAQK,EAAM,YAAaK,GAG/F,QAASC,KAELZ,EAAE,sBAAsBa,GAAG,QAAS,WAChCb,EAAE,eAAec,OAEjBb,EAAUA,UAAU,kCAAmC,OAAQ,OAAQ,GAAI,WAAYc,KAG3Ff,EAAE,qBAAqBa,GAAG,QAAS,WAC/Bb,EAAE,eAAec,SAIzB,QAASC,KACLV,IACAL,EAAE,gBAAgBc,OAGtB,QAASH,GAAgBK,GACrB,GAEIC,GAFAC,EAASF,EAAWE,OACpBC,EAAc,OAEJ,IAAVD,GAEAD,EAAY,MACZE,EAAc,SACdnB,EAAE,gBAAgBoB,UACD,GAAVF,EAEPD,EAAY,MACK,GAAVC,GACPD,EAAYD,EAAWK,cAAgB,OACvCF,EAAc,SACdnB,EAAE,gBAAgBoB,UAGlBH,EAAY,MAEhBjB,EAAE,cAAcsB,SAASH,GACzBnB,EAAE,cAAcuB,KAAKN,EACrB,IAAIO,GAAYC,EAAgBT,EAAWU,KAAKC,YAC5CC,EAAUH,EAAgBT,EAAWU,KAAKG,SAC9C7B,GAAE,qBAAqBuB,KAAKC,EAAY,MAAQI,EAChD,IAAIE,GAAad,EAAWU,KAAKK,WACjC/B,GAAE,mBAAmBuB,KAAKO,GAC1B9B,EAAE,oBAAoBgC,KAAK,cAAehB,EAAWU,KAAKhB,aAC1DV,EAAE,WAAWiC,SACbC,EAAclB,EAAWmB,OACzBnC,EAAE,kBAAkBuB,KAAKP,EAAWU,KAAKU,MAG7C,QAASF,GAAcC,GACnB,IAAK,GAAIE,GAAI,EAAGA,EAAIF,EAAMG,OAAQD,IAAK,CACnC,GAAIE,GAAOJ,EAAME,GACbG,EAAUC,SAASF,EAAKC,QAAU,KAAO,IACzCE,EAAcD,SAASF,EAAKG,YAAc,KAAO,IACjDC,EAAU,KAAOH,EAAU,IAAME,CACrC,IAAS,GAALL,EAEArC,EAAE,kBAAkBuB,KAAKoB,OACtB,CACH,GAAIC,GAAO,kDAAoDD,EAAU,YACzE3C,GAAE,iBAAiB6C,OAAOD,KAMtC,QAASnB,GAAgBqB,GACrB,GAAIC,GAAUD,EAAQE,MAAM,IAC5B,OAAOD,GAAQ,GAInB,QAAStC,GAAoBwC,GACzB,GAAIC,GAAM,GAAIC,QAAO,QAAUF,EAAO,iBAClCG,EAAIC,OAAOC,SAASC,OAAOC,OAAO,GAAGC,MAAMP,EAC/C,OAAS,OAALE,EAAkBM,SAASN,EAAE,IAC1B,KArGXpD,EAAE2D,UAAUC,MAAM,WAEdvD,IACAL,EAAE,gBAAgBa,GAAG,QAAS,WAE1Bb,EAAE,eAAeoB,WAErBR,IACAZ,EAAE,kBAAkBa,GAAG,QAAS,WAC5B,GAAIgD,GAAUP,SAASQ,SAAW,KAAOR,SAASS,KAAO,sDAAwDtD,EAAoB,cACrIL,GAAQ4D,SAASH","file":"../../../js/b/activity_detail.js","sourcesContent":["\"use strict\";\n\nrequire(['../require-config'], function () {\n    require([\"zepto\", \"ajax_rule\", \"scroll_more\", \"date_change\", \"if_menu\"], function ($, ajax_rule, scroll_more, date_change, if_menu) {\n        $(function () {\n            $(document).ready(function () {\n                //获取信息--todo\n                activity_detail_request();\n                $('.js_stop_but').on('click', function () {\n                    //停止活动\n                    $('#alert_view').toggle();\n                });\n                configur_alert_action();\n                $('.js_modify_but').on('click', function () {\n                    var url_val = location.protocol + '//' + location.host + '/prepaid/v1/page/b/alter_activity.html?activity_id=' + getQueryParamString('activity_id');\n                    if_menu.goto_url(url_val);\n                });\n            });\n            /*************************************** private func **************************************/\n            function activity_detail_request() {\n                var data = new Object();\n                var activityId = getQueryParamString('activity_id');\n                if (activityId) {\n                    data.activity_id = activityId;\n                }\n                ajax_rule.ajax_rule('/prepaid/v1/api/b/activity_detail', 'GET', 'json', data, '.zheceng1', request_success);\n            }\n            //弹框按钮点击事件\n            function configur_alert_action() {\n                //点击的确认\n                $('.alert_but_confirm').on('click', function () {\n                    $('#alert_view').hide();\n                    //停止活动请求\n                    ajax_rule.ajax_rule('/prepaid/v1/api/b/activity/stop', 'POST', 'json', '', '.zheceng', stop_activity_success);\n                });\n                //点击的取消\n                $('.alert_but_cancel').on('click', function () {\n                    $('#alert_view').hide();\n                });\n            }\n            //停止活动请求成功\n            function stop_activity_success() {\n                activity_detail_request();\n                $('.but_content').hide();\n            }\n            //请求成功\n            function request_success(detailDict) {\n                var status = detailDict.status;\n                var statusColor = 'black';\n                var statusStr;\n                if (status == 1) {\n                    //活动进行中\n                    statusStr = '进行中';\n                    statusColor = 'orange';\n                    $('.but_content').toggle();\n                } else if (status == 2) {\n                    //已结束\n                    statusStr = '已结束';\n                } else if (status == 0) {\n                    statusStr = detailDict.countdown_day + '天后开始';\n                    statusColor = 'orange';\n                    $('.but_content').toggle();\n                } else {\n                    //已终止\n                    statusStr = '已终止';\n                }\n                $('.js_status').addClass(statusColor);\n                $('.js_status').html(statusStr);\n                var startTime = splitDateString(detailDict.info.start_time);\n                var endTime = splitDateString(detailDict.info.end_time);\n                $('.js_activity_date').html(startTime + ' - ' + endTime);\n                var updateTime = detailDict.info.update_time;\n                $('.js_update_date').html(updateTime);\n                $('.activity_detail').attr('activity_id', detailDict.info.activity_id);\n                $('li.rule').remove();\n                configurRules(detailDict.rules);\n                $('.js_desription').html(detailDict.info.desc);\n            }\n            //更新规则\n            function configurRules(rules) {\n                for (var i = 0; i < rules.length; i++) {\n                    var rule = rules[i];\n                    var pay_amt = parseInt(rule.pay_amt / 100) + '元';\n                    var present_amt = parseInt(rule.present_amt / 100) + '元';\n                    var ruleStr = '储值' + pay_amt + '送' + present_amt;\n                    if (i == 0) {\n                        //第一条规则\n                        $('.js_first_rule').html(ruleStr);\n                    } else {\n                        var cell = '<li class=\"detail_cell rule\"><dt class=\"black\">' + ruleStr + '</dt></li>';\n                        $('#rule_section').append(cell);\n                    }\n                }\n            }\n\n            //处理时间\n            function splitDateString(dateStr) {\n                var strings = dateStr.split(' ');\n                return strings[0];\n            }\n\n            //获取查询参数\n            function getQueryParamString(name) {\n                var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n                var r = window.location.search.substr(1).match(reg);\n                if (r != null) return unescape(r[2]);\n                return null;\n            }\n        });\n    });\n});"]}
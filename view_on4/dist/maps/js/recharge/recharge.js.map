{"version":3,"sources":["recharge/recharge.js"],"names":["hideMenu","WeixinJSBridge","call","click_chulist","obj","$","addClass","siblings","removeClass","document","addEventListener","attachEvent","require","ajax_rule","screen_button","scr_mobile","src_rule","src_note","body_height","height","fixedb_height","window_height","hide","show","get_rules","return_data_data","return_expired","expired","return_data","rules","return_data_right","each","i","item","tx_fee","present_amt","toFixed","tx_txamt","pay_amt","push","data_length","length","css","li_detail","tx_index","grid_index","append","eq","get_rulesdetail","return_data_l","get_merchant","shopname","text","get_bindinfo","mobile","get_bindinfo_error","get_balance","balance","get_pay_money","recharge_num","recharge","recharge_url","url","window","location","href","data_recharge","c","get_hash","h","o","attr","get_recharge","get_bindinfo_if","data_bindinfo","get_bindinfo_if_error","hash_val","c_val","split","url_l","url_l_l","url_val","innerHeight","ready","data_rules","data_rulesdetail","data_merchant","data_before","data_balance","on","_hmt"],"mappings":"AAAA,YAEA,SAASA,YACLC,eAAeC,KAAK,kBACpBD,eAAeC,KAAK,eAaxB,QAASC,eAAcC,GACnBC,EAAED,GAAKE,SAAS,aAAaC,SAAS,MAAMC,YAAY,aAZ/B,mBAAlBP,gBACHQ,SAASC,iBACTD,SAASC,iBAAiB,sBAAuBV,UAAU,GACpDS,SAASE,cAChBF,SAASE,YAAY,sBAAuBX,UAC5CS,SAASE,YAAY,wBAAyBX,WAGlDA,WAMJY,SAAS,qBAAsB,WAC3BA,SAAS,QAAS,aAAc,SAAUP,EAAGQ,GACzCR,EAAE,WA+DE,QAASS,KACL,SAAKC,GAAeC,GAAaC,KAGjCC,EAAcb,EAAE,QAAQc,cACpBD,EAAcE,EAAgBC,GAAiB,GAC/ChB,EAAE,oBAAoBiB,OACtBjB,EAAE,uBAAuBkB,OACzBlB,EAAE,oBAAoBG,YAAY,cAElCH,EAAE,oBAAoBkB,OACtBlB,EAAE,uBAAuBiB,OACzBjB,EAAE,oBAAoBC,SAAS,eAIvC,QAASkB,GAAUC,GAEf,GAAIC,GAAiBD,EAAiBE,OACtC,IAAsB,KAAlBD,EAGA,MAFArB,GAAE,eAAekB,OACjBlB,EAAE,eAAeiB,QACV,CAEPjB,GAAE,eAAeiB,OACjBjB,EAAE,eAAekB,MAErB,IAAIK,GAAcH,EAAiBI,MAE/BC,IACJzB,GAAEuB,GAAaG,KAAK,SAAUC,EAAGC,GAC7B,GAAIC,IAAUN,EAAYI,GAAGG,YAAc,KAAKC,QAAQ,GACpDC,GAAYT,EAAYI,GAAGM,QAAU,KAAKF,QAAQ,EAClDF,IAAU,GAAKG,GAAY,GAC3BP,EAAkBS,KAAKN,IAG/B,IAAIO,GAAcV,EAAkBW,MACpC,OAAmB,KAAfD,GACAnC,EAAE,wBAAwBkB,OAAOmB,IAAI,UAAW,gBAChDrC,EAAE,mBAAmBiB,QACd,IAEPjB,EAAE,wBAAwBiB,OAC1BjB,EAAE,mBAAmBkB,OAAOmB,IAAI,UAAW,gBAE/CrC,EAAEyB,GAAmBC,KAAK,SAAUC,EAAGC,GACnC,GAGIU,GAHAT,GAAUJ,EAAkBE,GAAGG,YAAc,KAAKC,QAAQ,GAC1DC,GAAYP,EAAkBE,GAAGM,QAAU,KAAKF,QAAQ,GACxDQ,EAAWd,EAAkBE,GAAGa,UAGhCF,GADe,KAAfH,EACY,gEAAkEI,EAAW,sDAAwDP,EAAW,mDAAqDH,EAAS,wEACpM,KAAfM,EACK,gEAAkEI,EAAW,sDAAwDP,EAAW,mDAAqDH,EAAS,wEAE9M,iDAAmDU,EAAW,sDAAwDP,EAAW,mDAAqDH,EAAS,wEAE/M7B,EAAE,kBAAkByC,OAAOH,KAE/BtC,EAAE,qBAAqB0C,GAAG,GAAGzC,SAAS,aAEtCU,EAAW,WACXF,MAGJ,QAASkC,GAAgBvB,GAGrB,IAAK,GAFDG,GAAcH,EACdwB,EAAgBrB,EAAYa,OACvBT,EAAI,EAAGA,EAAIiB,EAAejB,IAAK,CACpC,GAAIW,GAAY,aAAef,EAAYI,GAAK,cAChD3B,GAAE,sBAAsByC,OAAOH,GAGnC1B,EAAW,OACXH,IAGJ,QAASoC,GAAatB,GAClB,GAAIuB,GAAWvB,EAAYuB,QAC3B9C,GAAE,gBAAgB+C,KAAKD,GAG3B,QAASE,GAAazB,GAClB,GAAI0B,GAAS1B,EAAY0B,MACzB,OAAKA,IAILjD,EAAE,cAAc+C,KAAKE,GAErBvC,EAAa,WACbD,OANIT,EAAE,kBAAkBiB,QACb,GAQf,QAASiC,KACLlD,EAAE,kBAAkBiB,OAEpBP,EAAa,OACbD,IAGJ,QAAS0C,GAAY5B,GACjB,GAAI6B,IAAW7B,EAAY6B,QAAU,KAAKrB,QAAQ,EAClD/B,GAAE,eAAe+C,KAAKK,GAG1B,QAASC,GAAcjC,GACnB,GAAIG,GAAcH,EACdkC,EAAe/B,EAAYgC,SAC3BC,EAAejC,EAAYkC,GAC/B,IAAoB,KAAhBH,EACAI,OAAOC,SAASC,KAAOJ,MACpB,CACH,GAAIK,IACAC,EAAKC,EAAS,KACdC,EAAKD,EAAS,KACdE,EAAKF,EAAS,KACdvB,WAAcxC,EAAE,+BAA+BkE,KAAK,cAExD1D,GAAUA,UAAU,6BAA8B,OAAQ,OAAQqD,EAAe,YAAaM,IAItG,QAASA,GAAa5C,GAClBmC,OAAOC,SAASC,KAAOrC,EAAYkC,IAGvC,QAASW,GAAgB7C,GACrB,GAAI+B,GAAe/B,EAAYgC,QAC/B,IAAoB,KAAhBD,EACAtD,EAAE,kBAAkBiB,OAEpBP,EAAa,OACbD,QACG,CACH,GAAI4D,IACAP,EAAKC,EAAS,KAElBvD,GAAUA,UAAU,8BAA+B,MAAO,OAAQ6D,EAAe,YAAarB,EAAcE,IAIpH,QAASoB,KAEL5D,EAAa,OACbD,IAIJ,QAASsD,GAASQ,GACd,GAAIC,EACJ,IAAIb,SAASC,KAAKa,MAAM,KAAKrC,OAAS,EAClC,OAAO,CAIX,KAAK,GAFDsC,GAAQf,SAASC,KAAKa,MAAM,KAAK,GAAGA,MAAM,KAC1CE,EAAUD,EAAMtC,OACXT,EAAI,EAAGA,EAAIgD,EAAShD,IAAK,CAC9B,GAAIiD,GAAUF,EAAM/C,GAAG8C,MAAM,IAC7B,IAAIG,EAAQ,IAAML,EAEd,MADAC,GAAQI,EAAQ,IA7NxBjB,SAASC,KAAKa,MAAM,KAAKrC,OAAS,GAClCpC,EAAE,kBAAkBkE,KAAK,OAAQ,gCAAkCP,SAASC,KAAKa,MAAM,KAAK,GAIhG,IAAIzD,GAAgB0C,OAAOmB,YACvB9D,EAAgBf,EAAE,oBAAoBc,SACtCD,EAAcb,EAAE,QAAQc,SACxBJ,GAAa,EACbC,GAAW,EACXC,GAAW,CACfZ,GAAEI,UAAU0E,MAAM,WAEd,GAAIC,IACAjB,EAAKC,EAAS,KACdC,EAAKD,EAAS,KAElBvD,GAAUA,UAAU,mCAAoC,MAAO,OAAQuE,EAAY,WAAY5D,EAG/F,IAAI6D,IACAlB,EAAKC,EAAS,KACdC,EAAKD,EAAS,KAElBvD,GAAUA,UAAU,+BAAgC,MAAO,OAAQwE,EAAkB,YAAarC,EAGlG,IAAIsC,IACAjB,EAAKD,EAAS,KAElBvD,GAAUA,UAAU,kCAAmC,MAAO,OAAQyE,EAAe,YAAapC,EAGlG,IAAIqC,IACApB,EAAKC,EAAS,KACdC,EAAKD,EAAS,KACdE,EAAKF,EAAS,KACdvB,WAAc,IAElBhC,GAAUA,UAAU,oCAAqC,MAAO,OAAQ0E,EAAa,YAAad,EAAiBE,EAGnH,IAAIa,IACArB,EAAKC,EAAS,KACdC,EAAKD,EAAS,KAElBvD,GAAUA,UAAU,4BAA6B,MAAO,OAAQ2E,EAAc,YAAahC,KAG/FnD,EAAE,mBAAmBoF,GAAG,QAAS,WAC7BC,KAAKnD,MAAM,cAAe,WAAY,QAAS,gBAE/C,IAAIgD,IACApB,EAAKC,EAAS,KACdC,EAAKD,EAAS,KACdE,EAAKF,EAAS,KACdvB,WAAcxC,EAAE,+BAA+BkE,KAAK,cAExD1D,GAAUA,UAAU,oCAAqC,MAAO,OAAQ0E,EAAa,YAAa7B","file":"../../../js/recharge/recharge.js","sourcesContent":["'use strict';\n\nfunction hideMenu() {\n    WeixinJSBridge.call('hideOptionMenu');\n    WeixinJSBridge.call('hideToolbar');\n}\nif (typeof WeixinJSBridge == \"undefined\") {\n    if (document.addEventListener) {\n        document.addEventListener('WeixinJSBridgeReady', hideMenu, false);\n    } else if (document.attachEvent) {\n        document.attachEvent('WeixinJSBridgeReady', hideMenu);\n        document.attachEvent('onWeixinJSBridgeReady', hideMenu);\n    }\n} else {\n    hideMenu();\n}\n//点击储值项\nfunction click_chulist(obj) {\n    $(obj).addClass('li_choose').siblings('li').removeClass('li_choose');\n};\nrequire(['../require-config'], function () {\n    require([\"zepto\", \"ajax_rule\"], function ($, ajax_rule) {\n        $(function () {\n            //修改--储值协议链接\n            if (location.href.split('?').length > 1) {\n                $('.js_protol_url').attr('href', '/prepaid/v1/page/c/pacp.html?' + location.href.split('?')[1]);\n            }\n            //储值首页----------------------------------------------------------------------------------------------------------------------------------------------------\n            //判断屏幕是否超过一屏，按钮是否是固定\n            var window_height = window.innerHeight;\n            var fixedb_height = $('.js_fixed_button').height();\n            var body_height = $('body').height();\n            var scr_mobile = false,\n                src_rule = false,\n                src_note = false;\n            $(document).ready(function () {\n                //获取储值列表todo-show\n                var data_rules = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h')\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge/rules', 'GET', 'json', data_rules, '.zheceng', get_rules);\n\n                //获取储值规则\n                var data_rulesdetail = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h')\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/rulexplain', 'GET', 'json', data_rulesdetail, '.zheceng1', get_rulesdetail);\n\n                //获取商家名称\n                var data_merchant = {\n                    'h': get_hash('h')\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/merchant_info', 'GET', 'json', data_merchant, '.zheceng1', get_merchant);\n\n                //获取储值账户          \n                var data_before = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                    'o': get_hash('o'),\n                    'grid_index': '1'\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge/before', 'GET', 'json', data_before, '.zheceng2', get_bindinfo_if, get_bindinfo_if_error);\n\n                //获取储值余额\n                var data_balance = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h')\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/balance', 'GET', 'json', data_balance, '.zheceng1', get_balance);\n            });\n            //点击购买弹出填写信息——————add_new\n            $('.js_content_sub').on('click', function () {\n                _hmt.push(['_trackEvent', 'recharge', 'click', 'recharge_buy']);\n                //充值前校验\n                var data_before = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                    'o': get_hash('o'),\n                    'grid_index': $('.js_rechage_ul li.li_choose').attr('data-index')\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge/before', 'GET', 'json', data_before, '.zheceng2', get_pay_money);\n            });\n            //判断屏幕与按钮的关系\n            function screen_button() {\n                if (!scr_mobile || !src_rule || !src_note) {\n                    return false;\n                }\n                body_height = $('body').height();\n                if (body_height + fixedb_height - window_height >= 0) {\n                    $('.js_fixed_button').hide();\n                    $('.js_relative_button').show();\n                    $('.js_section_mark').removeClass('margin_b');\n                } else {\n                    $('.js_fixed_button').show();\n                    $('.js_relative_button').hide();\n                    $('.js_section_mark').addClass('margin_b');\n                }\n            }\n            //获取储值列表\n            function get_rules(return_data_data) {\n                //验证是否过期\n                var return_expired = return_data_data.expired;\n                if (return_expired == '1') {\n                    $('.js_li_none').show();\n                    $('.js_li_show').hide();\n                    return false;\n                } else {\n                    $('.js_li_none').hide();\n                    $('.js_li_show').show();\n                }\n                var return_data = return_data_data.rules;\n                //获取规则当中储值可用的规则\n                var return_data_right = [];\n                $(return_data).each(function (i, item) {\n                    var tx_fee = (return_data[i].present_amt / 100).toFixed(0);\n                    var tx_txamt = (return_data[i].pay_amt / 100).toFixed(0);\n                    if (tx_fee >= 1 && tx_txamt >= 1) {\n                        return_data_right.push(item);\n                    }\n                });\n                var data_length = return_data_right.length;\n                if (data_length == '0') {\n                    $('.js_content_sub_disa').show().css('display', 'inline-block');\n                    $('.js_content_sub').hide();\n                    return false;\n                } else {\n                    $('.js_content_sub_disa').hide();\n                    $('.js_content_sub').show().css('display', 'inline-block');\n                }\n                $(return_data_right).each(function (i, item) {\n                    var tx_fee = (return_data_right[i].present_amt / 100).toFixed(0);\n                    var tx_txamt = (return_data_right[i].pay_amt / 100).toFixed(0);\n                    var tx_index = return_data_right[i].grid_index;\n                    var li_detail;\n                    if (data_length == '1') {\n                        li_detail = '<li class=\"li_one\" onclick=\"click_chulist(this)\" data-index=\"' + tx_index + '\"><p class=\"font_17\">储值<span class=\"js_rechar_num\">' + tx_txamt + '</span>元</p><p>送<span class=\"js_rechar_sendnum\">' + tx_fee + '</span>元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                    } else if (data_length == '2') {\n                        li_detail = '<li class=\"li_two\" onclick=\"click_chulist(this)\" data-index=\"' + tx_index + '\"><p class=\"font_17\">储值<span class=\"js_rechar_num\">' + tx_txamt + '</span>元</p><p>送<span class=\"js_rechar_sendnum\">' + tx_fee + '</span>元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                    } else {\n                        li_detail = '<li onclick=\"click_chulist(this)\" data-index=\"' + tx_index + '\"><p class=\"font_17\">储值<span class=\"js_rechar_num\">' + tx_txamt + '</span>元</p><p>送<span class=\"js_rechar_sendnum\">' + tx_fee + '</span>元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                    }\n                    $(\".js_rechage_ul\").append(li_detail);\n                });\n                $(\".js_rechage_ul li\").eq(0).addClass('li_choose');\n                //成功后重新判断body高度\n                src_rule = 'ture';\n                screen_button();\n            }\n            //获取储值规则\n            function get_rulesdetail(return_data_data) {\n                var return_data = return_data_data;\n                var return_data_l = return_data.length;\n                for (var i = 0; i < return_data_l; i++) {\n                    var li_detail = '<li><span>' + return_data[i] + '</span></li>';\n                    $(\".js_note_ul_detail\").append(li_detail);\n                }\n                //成功后重新判断body高度\n                src_note = 'ture';\n                screen_button();\n            }\n            //获取商家名称\n            function get_merchant(return_data) {\n                var shopname = return_data.shopname;\n                $('.js_shopname').text(shopname);\n            }\n            //获取储值账户\n            function get_bindinfo(return_data) {\n                var mobile = return_data.mobile;\n                if (!mobile) {\n                    $('.js_mobilehang').hide();\n                    return false;\n                }\n                $('.js_mobile').text(mobile);\n                //根据储值账户现实与否--重新判断body高度\n                scr_mobile = 'ture';\n                screen_button();\n            }\n            //获取储值账户失败\n            function get_bindinfo_error() {\n                $('.js_mobilehang').hide();\n                //根据储值账户现实与否--重新判断body高度\n                scr_mobile = 'ture';\n                screen_button();\n            }\n            //获取余额\n            function get_balance(return_data) {\n                var balance = (return_data.balance / 100).toFixed(2);\n                $('.js_balance').text(balance);\n            }\n            //点击购买\n            function get_pay_money(return_data_data) {\n                var return_data = return_data_data;\n                var recharge_num = return_data.recharge;\n                var recharge_url = return_data.url;\n                if (recharge_num == '0') {\n                    window.location.href = recharge_url;\n                } else {\n                    var data_recharge = {\n                        'c': get_hash('c'),\n                        'h': get_hash('h'),\n                        'o': get_hash('o'),\n                        'grid_index': $('.js_rechage_ul li.li_choose').attr('data-index')\n                    };\n                    ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge', 'POST', 'json', data_recharge, '.zheceng2', get_recharge);\n                }\n            }\n            //提交充值\n            function get_recharge(return_data) {\n                window.location.href = return_data.url;\n            }\n            //判断是否调用--储值账户\n            function get_bindinfo_if(return_data) {\n                var recharge_num = return_data.recharge;\n                if (recharge_num == '0') {\n                    $('.js_mobilehang').hide();\n                    //根据储值账户现实与否--重新判断body高度\n                    scr_mobile = 'ture';\n                    screen_button();\n                } else {\n                    var data_bindinfo = {\n                        'c': get_hash('c')\n                    };\n                    ajax_rule.ajax_rule(' /prepaid/v1/api/c/bindinfo', 'GET', 'json', data_bindinfo, '.zheceng1', get_bindinfo, get_bindinfo_error);\n                }\n            }\n            //\n            function get_bindinfo_if_error() {\n                //根据储值账户现实与否--重新判断body高度\n                scr_mobile = 'ture';\n                screen_button();\n            }\n            //通用--------------------------------------------------------------------------------------------------------\n            //获取url的指定hash值\n            function get_hash(hash_val) {\n                var c_val;\n                if (location.href.split('?').length < 2) {\n                    return false;\n                }\n                var url_l = location.href.split('?')[1].split('&');\n                var url_l_l = url_l.length;\n                for (var i = 0; i < url_l_l; i++) {\n                    var url_val = url_l[i].split('=');\n                    if (url_val[0] == hash_val) {\n                        c_val = url_val[1];\n                        return c_val;\n                    }\n                }\n            }\n        });\n    });\n});"]}
{"version":3,"sources":["recharge/recharge.js"],"names":["hideMenu","WeixinJSBridge","call","click_chulist","obj","$","addClass","siblings","removeClass","document","addEventListener","attachEvent","require","ajax_rule","screen_button","scr_mobile","src_rule","src_note","body_height","height","fixedb_height","window_height","hide","show","get_rules","return_data_data","return_expired","expired","return_data","rules","return_data_right","each","i","item","tx_fee","present_amt","toFixed","tx_txamt","pay_amt","push","data_length","length","css","li_detail","tx_index","grid_index","append","eq","get_rulesdetail","return_data_l","get_merchant","shopname","text","get_bindinfo","mobile","get_bindinfo_error","get_balance","balance","get_pay_money","recharge_num","recharge","recharge_url","url","window","location","href","data_recharge","c","get_hash","h","o","attr","get_recharge","get_bindinfo_if","data_bindinfo","get_bindinfo_if_error","hash_val","c_val","split","url_l","url_l_l","url_val","innerHeight","ready","data_rules","data_rulesdetail","data_merchant","data_before","data_balance","on","_hmt"],"mappings":"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","file":"../../../js/recharge/recharge.js","sourcesContent":["function hideMenu() {\n    WeixinJSBridge.call('hideOptionMenu');\n    WeixinJSBridge.call('hideToolbar');\n}\nif (typeof WeixinJSBridge == \"undefined\") {\n    if (document.addEventListener) {\n        document.addEventListener('WeixinJSBridgeReady', hideMenu, false);\n    } else if (document.attachEvent) {\n        document.attachEvent('WeixinJSBridgeReady', hideMenu);\n        document.attachEvent('onWeixinJSBridgeReady', hideMenu);\n    }\n} else {\n    hideMenu();\n}\n//点击储值项\nfunction click_chulist(obj) {\n    $(obj).addClass('li_choose').siblings('li').removeClass('li_choose');\n};\nrequire(['../require-config'], function() {\n    require([\"zepto\", \"ajax_rule\"], function($, ajax_rule) {\n        $(function() {\n            //修改--储值协议链接\n            if(location.href.split('?').length>1){\n                $('.js_protol_url').attr('href','/prepaid/v1/page/c/pacp.html?'+location.href.split('?')[1]);\n            }\n            //储值首页----------------------------------------------------------------------------------------------------------------------------------------------------\n            //判断屏幕是否超过一屏，按钮是否是固定\n            var window_height = window.innerHeight;\n            var fixedb_height = $('.js_fixed_button').height();\n            var body_height = $('body').height();\n            var scr_mobile = false,\n                src_rule = false,\n                src_note = false;\n            $(document).ready(function() {\n                //获取储值列表todo-show\n                var data_rules = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge/rules', 'GET', 'json', data_rules, '.zheceng', get_rules);\n\n                //获取储值规则\n                var data_rulesdetail = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/rulexplain', 'GET', 'json', data_rulesdetail, '.zheceng1', get_rulesdetail);\n\n                //获取商家名称\n                var data_merchant = {\n                    'h': get_hash('h'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/merchant_info', 'GET', 'json', data_merchant, '.zheceng1', get_merchant);\n\n                //获取储值账户          \n                var data_before = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                    'o': get_hash('o'),\n                    'grid_index': '1',\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge/before', 'GET', 'json', data_before, '.zheceng2', get_bindinfo_if, get_bindinfo_if_error);\n\n                //获取储值余额\n                var data_balance = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/balance', 'GET', 'json', data_balance, '.zheceng1', get_balance);\n            });\n            //点击购买弹出填写信息——————add_new\n            $('.js_content_sub').on('click', function() {\n                _hmt.push(['_trackEvent', 'recharge', 'click', 'recharge_buy']);\n                //充值前校验\n                var data_before = {\n                    'c': get_hash('c'),\n                    'h': get_hash('h'),\n                    'o': get_hash('o'),\n                    'grid_index': $('.js_rechage_ul li.li_choose').attr('data-index'),\n                };\n                ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge/before', 'GET', 'json', data_before, '.zheceng2', get_pay_money);\n            });\n            //判断屏幕与按钮的关系\n            function screen_button() {\n                if (!scr_mobile || !src_rule || !src_note) {\n                    return false;\n                }\n                body_height = $('body').height();\n                if (body_height + fixedb_height - window_height >= 0) {\n                    $('.js_fixed_button').hide();\n                    $('.js_relative_button').show();\n                    $('.js_section_mark').removeClass('margin_b');\n                } else {\n                    $('.js_fixed_button').show();\n                    $('.js_relative_button').hide();\n                    $('.js_section_mark').addClass('margin_b');\n                }\n            }\n            //获取储值列表\n            function get_rules(return_data_data) {\n                //验证是否过期\n                var return_expired = return_data_data.expired;\n                if (return_expired == '1') {\n                    $('.js_li_none').show();\n                    $('.js_li_show').hide();\n                    return false;\n                } else {\n                    $('.js_li_none').hide();\n                    $('.js_li_show').show();\n                }\n                var return_data = return_data_data.rules;\n                //获取规则当中储值可用的规则\n                var return_data_right = [];\n                $(return_data).each(function(i, item) {\n                    var tx_fee = (return_data[i].present_amt / 100).toFixed(0);\n                    var tx_txamt = (return_data[i].pay_amt / 100).toFixed(0);\n                    if (tx_fee >= 1 && tx_txamt >= 1) {\n                        return_data_right.push(item);\n                    }\n                });\n                var data_length = return_data_right.length;\n                if (data_length == '0') {\n                    $('.js_content_sub_disa').show().css('display', 'inline-block');\n                    $('.js_content_sub').hide();\n                    return false;\n                } else {\n                    $('.js_content_sub_disa').hide();\n                    $('.js_content_sub').show().css('display', 'inline-block');\n                }\n                $(return_data_right).each(function(i, item) {\n                    var tx_fee = (return_data_right[i].present_amt / 100).toFixed(0);\n                    var tx_txamt = (return_data_right[i].pay_amt / 100).toFixed(0);\n                    var tx_index = return_data_right[i].grid_index;\n                    var li_detail;\n                    if (data_length == '1') {\n                        li_detail = '<li class=\"li_one\" onclick=\"click_chulist(this)\" data-index=\"' + tx_index + '\"><p class=\"font_17\">储值<span class=\"js_rechar_num\">' + tx_txamt + '</span>元</p><p>送<span class=\"js_rechar_sendnum\">' + tx_fee + '</span>元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                    } else if (data_length == '2') {\n                        li_detail = '<li class=\"li_two\" onclick=\"click_chulist(this)\" data-index=\"' + tx_index + '\"><p class=\"font_17\">储值<span class=\"js_rechar_num\">' + tx_txamt + '</span>元</p><p>送<span class=\"js_rechar_sendnum\">' + tx_fee + '</span>元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                    } else {\n                        li_detail = '<li onclick=\"click_chulist(this)\" data-index=\"' + tx_index + '\"><p class=\"font_17\">储值<span class=\"js_rechar_num\">' + tx_txamt + '</span>元</p><p>送<span class=\"js_rechar_sendnum\">' + tx_fee + '</span>元</p><span class=\"choose\"><i class=\"choose_i\"></i></span></li>';\n                    }\n                    $(\".js_rechage_ul\").append(li_detail);\n                });\n                $(\".js_rechage_ul li\").eq(0).addClass('li_choose');\n                //成功后重新判断body高度\n                src_rule = 'ture';\n                screen_button();\n            }\n            //获取储值规则\n            function get_rulesdetail(return_data_data) {\n                var return_data = return_data_data;\n                var return_data_l = return_data.length;\n                for (var i = 0; i < return_data_l; i++) {\n                    var li_detail = '<li><span>' + return_data[i] + '</span></li>';\n                    $(\".js_note_ul_detail\").append(li_detail);\n                }\n                //成功后重新判断body高度\n                src_note = 'ture';\n                screen_button();\n            }\n            //获取商家名称\n            function get_merchant(return_data) {\n                var shopname = return_data.shopname;\n                $('.js_shopname').text(shopname);\n            }\n            //获取储值账户\n            function get_bindinfo(return_data) {\n                var mobile = return_data.mobile;\n                if (!mobile) {\n                    $('.js_mobilehang').hide();\n                    return false;\n                }\n                $('.js_mobile').text(mobile);\n                //根据储值账户现实与否--重新判断body高度\n                scr_mobile = 'ture';\n                screen_button();\n            }\n            //获取储值账户失败\n            function get_bindinfo_error() {\n                $('.js_mobilehang').hide();\n                //根据储值账户现实与否--重新判断body高度\n                scr_mobile = 'ture';\n                screen_button();\n            }\n            //获取余额\n            function get_balance(return_data) {\n                var balance = (return_data.balance / 100).toFixed(2);\n                $('.js_balance').text(balance);\n            }\n            //点击购买\n            function get_pay_money(return_data_data) {\n                var return_data = return_data_data;\n                var recharge_num = return_data.recharge;\n                var recharge_url = return_data.url;\n                if (recharge_num == '0') {\n                    window.location.href = recharge_url;\n                } else {\n                    var data_recharge = {\n                        'c': get_hash('c'),\n                        'h': get_hash('h'),\n                        'o': get_hash('o'),\n                        'grid_index': $('.js_rechage_ul li.li_choose').attr('data-index'),\n                    };\n                    ajax_rule.ajax_rule('/prepaid/v1/api/c/recharge', 'POST', 'json', data_recharge, '.zheceng2', get_recharge);\n                }\n            }\n            //提交充值\n            function get_recharge(return_data) {\n                window.location.href = return_data.url;\n            }\n            //判断是否调用--储值账户\n            function get_bindinfo_if(return_data) {\n                var recharge_num = return_data.recharge;\n                if (recharge_num == '0') {\n                    $('.js_mobilehang').hide();\n                    //根据储值账户现实与否--重新判断body高度\n                    scr_mobile = 'ture';\n                    screen_button();\n                } else {\n                    var data_bindinfo = {\n                        'c': get_hash('c'),\n                    };\n                    ajax_rule.ajax_rule(' /prepaid/v1/api/c/bindinfo', 'GET', 'json', data_bindinfo, '.zheceng1', get_bindinfo, get_bindinfo_error);\n                }\n\n            }\n            //\n            function get_bindinfo_if_error() {\n                //根据储值账户现实与否--重新判断body高度\n                scr_mobile = 'ture';\n                screen_button();\n            }\n            //通用--------------------------------------------------------------------------------------------------------\n            //获取url的指定hash值\n            function get_hash(hash_val) {\n                var c_val;\n                if (location.href.split('?').length < 2) {\n                    return false;\n                }\n                var url_l = location.href.split('?')[1].split('&');\n                var url_l_l = url_l.length;\n                for (var i = 0; i < url_l_l; i++) {\n                    var url_val = url_l[i].split('=');\n                    if (url_val[0] == hash_val) {\n                        c_val = url_val[1];\n                        return c_val;\n                    }\n                }\n            }\n        })\n    });\n});\n"]}
/**
 * rechargeB - rechargeB详情
 * @version v1.0.0
 * @link 
 * @license ISC
 */
function delete_rule(e){var t=$(".js_rule dd").length-0;2==t&&($(e).parents("dd").remove(),$(".js_rule dd i.js_ruledelete").remove()),$(e).parents("dd").remove(),$(".js_rule_error").removeClass("span_tips"),$(".js_add_activity").find(".add_rule").css("display","inline-block"),$(".js_add_activity").find(".add_rule_no").css("display","none")}require(["../require-config"],function(){require(["zepto","yanzheng","ajax_rule","localstorage","iosselect","date_get","alert_word"],function($,e,t,a,s,i,n){$(function(){function t(){var e=$(".js_startime"),t=$(".js_endtime"),a='<i class="ic_tips"></i>';if(e.val()&&t.val()){var s=e.attr("data-year"),i=e.attr("data-month"),n=e.attr("data-day"),r=t.attr("data-year"),l=t.attr("data-month"),o=t.attr("data-day"),_=s+"/"+i+"/"+n+" 00:00:00",u=r+"/"+l+"/"+o+" 23:59:59",c=new Date(_).getTime(),m=new Date(u).getTime(),j=new Date(d).getTime();if(c-j<0)return $(".js_timetips").addClass("error_tips").find("span").html(a+"开始不能比今天早"),!1;$(".js_timetips").removeClass("error_tips").find("span").html(""),m-c>31536e6?$(".js_timetips").addClass("error_tips").find("span").html(a+"时间范围在365天之内"):m-c>=0?$(".js_timetips").removeClass("error_tips").find("span").html(""):$(".js_timetips").addClass("error_tips").find("span").html(a+"结束时间不能比开始时间早")}else $(".js_timetips").addClass("error_tips").find("span").html(a+"时间范围在365天之内")}function r(){$(".js_startime").focus();var e=$(".js_note").val().length-0;$(".js_wordtip span").text(40-e);var t=$("#startime").val(),s=t.split("-");t?($(".js_startime").data("year",s[0]),$(".js_startime").data("month",s[1]),$(".js_startime").data("day",s[2]),$(".js_startime").val(s[1]+"月"+s[2]+"日")):($(".js_startime").data("year",i.nowYear),$(".js_startime").data("month",i.nowMonth),$(".js_startime").data("day",i.nowDate),$("#startime").val(i.nowYear+"-"+i.nowMonth+"-"+i.nowDate),$(".js_startime").val("今天"));var n=$("#endtime").val(),r=n.split("-");n?($(".js_endtime").data("year",r[0]),$(".js_endtime").data("month",r[1]),$(".js_endtime").data("day",r[2]),$(".js_endtime").val(r[1]+"月"+r[2]+"日")):($(".js_endtime").data("year",i.nowYear),$(".js_endtime").data("month",i.nowMonth),$(".js_endtime").data("day",i.nowDate),$("#endtime").val(i.nowYear+"-"+i.nowMonth+"-"+i.nowDate),$(".js_endtime").val(""));var d=a.getone_storage("rules");if(!d)return!1;var l=JSON.parse(d);l.length>1?$(".js_rule dd").eq(0).append('<i class="delete js_ruledelete" onclick="delete_rule(this)"></i>'):$(".js_rule dd").eq(0).find("i.js_ruledelete").remove(),l.length>=4?($(".js_rule").find(".add_rule").css("display","none"),$(".js_rule").find(".add_rule_no").css("display","inline-block")):($(".js_rule").find(".add_rule").css("display","inline-block"),$(".js_rule").find(".add_rule_no").css("display","none"));for(var o=0;o<l.length;o++){var _=(l[o].pay_amt/100).toFixed(0),u=(l[o].present_amt/100).toFixed(0),c=l[o].grid_index;if(0==o)$(".js_rule dd").eq(0).find(".js_chu").val(_),$(".js_rule dd").eq(0).find(".js_song").val(u),$(".js_rule dd").eq(0).attr("data-index",c);else{var m='<dd data-index="'+c+'">储值<input class="text text_short js_chu js_storule" type="tel" value="'+_+'" name="chu" />元送<input class="text text_short js_song js_storule" type="tel" value="'+u+'" name="song" />元<i class="delete js_ruledelete" onclick="delete_rule(this)"></i></dd>';$(".js_rule").append(m)}}}n.toast_data_short("body","储值金额不可超过2000元");var d=i.nowYear+"/"+i.nowMonth+"/"+i.nowDate+" 00:00:00";$(document).ready(function(){a.get_storage(r)}),$(".js_startime").on("click",function(){var e=document.querySelector(".js_startime"),t=e.dataset.year,a=e.dataset.month,n=e.dataset.day;new s(3,[i.yearData,i.monthData,i.dateData],{container:".ios_select_container",title:"选择开始时间",itemHeight:50,itemShowCount:3,relation:[1,1,0,0],oneLevelId:t,twoLevelId:a,threeLevelId:n,callback:function(t,a,s){e.dataset.year=t.id,e.dataset.month=a.id,e.dataset.day=s.id,e.value=a.id+"月"+s.id+"日",$("#startime").val(t.id+"-"+a.id+"-"+s.id)}})}),$(".js_endtime").on("click",function(){var e=document.querySelector(".js_endtime"),t=e.dataset.year,a=e.dataset.month,n=e.dataset.day;new s(3,[i.yearData,i.monthData,i.dateData],{container:".ios_select_container",title:"选择结束时间",itemHeight:50,itemShowCount:3,relation:[1,1,0,0],oneLevelId:t,twoLevelId:a,threeLevelId:n,callback:function(t,a,s){e.dataset.year=t.id,e.dataset.month=a.id,e.dataset.day=s.id,e.value=a.id+"月"+s.id+"日",$("#endtime").val(t.id+"-"+a.id+"-"+s.id)}})}),$(".js_add_activity").on("click",function(){var e=$(".js_rule dd").length-0,t='<dd data-index="">储值<input class="text text_short js_chu js_storule" type="tel" value="" name="pay_amt" />元送<input class="text text_short js_song js_storule" type="tel" value="" name="present_amt" />元<i class="delete js_ruledelete" onclick="delete_rule(this)"></i></dd>';e<=3?(1==e&&$(".js_rule dd").append('<i class="delete js_ruledelete" onclick="delete_rule(this)"></i>'),3==e&&($(this).find(".add_rule").css("display","none"),$(this).find(".add_rule_no").css("display","inline-block")),$(".js_rule").append(t),$(".js_rule_error").removeClass("span_tips")):$(".js_rule_error").addClass("span_tips")}),$(document).on("input",".js_storule",function(){var e=$(this).val(),t=e.replace(/[^\d]/g,"");if(0==t.length)return $(this).val(""),!1;if(1==t.length&&"0"==t)return $(this).val(""),!1;var a=t.split(".")[0],s=a.substr(0,1);if("0"==s&&(a=a.substr(1)),a.length>4&&(a=a.substr(0,4)),t.split(".").length>1){var i=t.split(".")[1].substr(0,2);t=a-0+"."+i}else t=a-0;$(this).val(t)}),$(".js_note").on("input",function(){var e=$(this).val(),t=e.length-0;return t<=40&&void $(".js_wordtip").find("span").text(40-t)}),$(".js_addactivity_sub").on("click",function(){e.tel_activity(".js_tel"),e.name_test(".js_note",0,40),t(),$(".js_storule").each(function(){e.numprice_test(this,0,4,2e3)}),$(".js_storule").each(function(){if($(this).hasClass("error_tips"))return n.alert_word_show_short(),!1});var s=$(".error_tips").length;if(s>0)return!1;a.set_storage();for(var i=[],r=$(".js_rule dd").length,d=0;d<r;d++){var l=$(".js_rule dd").eq(d),o=(l.find(".js_chu").attr("name"),l.find(".js_chu").val()),_=(l.find(".js_song").attr("name"),l.find(".js_song").val()),u={grid_index:d+1,pay_amt:100*o,present_amt:100*_};i.push(u)}a.setone_storage("rules",JSON.stringify(i)),location.href=location.protocol+"//"+location.host+"/prepaid/v1/page/b/activity_preview.html"})})})});